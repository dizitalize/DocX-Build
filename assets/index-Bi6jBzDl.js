import{r as f,b as dt,u as ut,N as ft,c as Ae,R as Xe,d as le,g as ht,e as qe,f as Ke,h as G,i as ne,B as mt}from"./react-BGFTG1xr.js";import{S as pt,M as gt,a as Ye,C as xt,U as bt,b as yt,c as Fe,L as Ve,T as wt,d as vt,e as jt,f as kt,F as Te,g as De,P as Qe,h as Nt,i as St,j as Et,B as Lt,I as Ct,k as At,l as Ft,m as Tt,n as Dt,o as It,p as Bt,Q as Ot,q as Mt,r as Rt,s as Pt,t as Ut,u as $t,v as zt,H as Ht,w as Wt,R as _t,X as Jt}from"./icons-Dm3c1Kyp.js";import{N as Xt,m as qt,a as Kt,T as Yt,E as Vt,u as Qt,S as Zt,U as Gt,L as en,H as tn,b as nn,c as sn,d as rn,e as on,f as an,g as cn}from"./tiptap-Hx5odmou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();var Ze={exports:{}},ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ln=f,dn=Symbol.for("react.element"),un=Symbol.for("react.fragment"),fn=Object.prototype.hasOwnProperty,hn=ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mn={key:!0,ref:!0,__self:!0,__source:!0};function Ge(e,n,s){var o,r={},a=null,i=null;s!==void 0&&(a=""+s),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(i=n.ref);for(o in n)fn.call(n,o)&&!mn.hasOwnProperty(o)&&(r[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)r[o]===void 0&&(r[o]=n[o]);return{$$typeof:dn,type:e,key:a,ref:i,props:r,_owner:hn.current}}ge.Fragment=un;ge.jsx=Ge;ge.jsxs=Ge;Ze.exports=ge;var t=Ze.exports,Ne={},Ie=dt;Ne.createRoot=Ie.createRoot,Ne.hydrateRoot=Ie.hydrateRoot;const Be="https://api.github.com",Oe="Dizitalize",Me="DocX",Re="main";let de=null;function et(){if(de!==null)return de;try{const e=require("../../key.json");return de=typeof e=="string"?e:e.pat||e.token||null,de}catch{return null}}function Pe(){const e=et(),n={Accept:"application/vnd.github.v3+json"};return e&&(n.Authorization=`token ${e}`),n}function pn(e){try{const n=typeof e=="string"?e:JSON.stringify(e);if(typeof globalThis.btoa=="function")return globalThis.btoa(unescape(encodeURIComponent(n)))}catch{}return""}async function gn(e,n,s=3){let o=0;for(;;)try{return await e()}catch(r){if(o++,o>=s)throw r;await new Promise(a=>setTimeout(a,150*o))}}class ${static dispatchSyncState(n){try{window.dispatchEvent(new CustomEvent("sync-state",{detail:n}))}catch{}}static dispatchBlocking(n){try{window.dispatchEvent(new CustomEvent("blocking-loader",{detail:n}))}catch{}}static async getFile(n){$.dispatchSyncState("flushing"),$.dispatchBlocking(!0);try{return await gn(async()=>{const s=await fetch(`${Be}/repos/${Oe}/${Me}/contents/${n}?ref=${Re}`,{headers:Pe(),cache:"no-cache"});if(!s.ok)return null;const o=await s.json(),r=o.sha,a=o.content,i=a?atob(a):null;try{return{json:i?JSON.parse(i):null,sha:r}}catch{return{json:i,sha:r}}})}finally{$.dispatchSyncState("idle"),$.dispatchBlocking(!1)}}static async putFile(n,s,o){var r;$.dispatchSyncState("flushing"),$.dispatchBlocking(!0),console.log("pushing json file to github:",n,s,o);try{if(s==null||typeof s=="string"&&s.trim()==="")return{ok:!1,reason:"Attempted to save empty/undefined/null content"};let a=s;if(typeof s=="object"&&(a=JSON.stringify(s)),!a||typeof a=="string"&&a.trim()==="")return{ok:!1,reason:"Attempted to save empty content after stringify"};const i=pn(a);if(!i||i.trim()==="")return{ok:!1,reason:"Attempted to save empty content after encodeContent"};const u={message:`Update ${n}`,content:i,branch:Re};o&&(u.sha=o);const h=await fetch(`${Be}/repos/${Oe}/${Me}/contents/${n}`,{method:"PUT",headers:{...Pe(),"Content-Type":"application/json"},body:JSON.stringify(u)});return h.ok?{ok:!0,sha:(r=(await h.json()).content)==null?void 0:r.sha}:{ok:!1,reason:await h.text()}}catch(a){return{ok:!1,reason:String(a)}}finally{$.dispatchSyncState("idle"),$.dispatchBlocking(!1)}}}const W=$.getFile,q=$.putFile;function X(){return!!et()}function xn(e,n="docxkey"){try{return atob(e).split("").map((s,o)=>String.fromCharCode(s.charCodeAt(0)^n.charCodeAt(o%n.length))).join("")}catch{return""}}const bn="displayNameEnc";function yn(){const e=localStorage.getItem(bn);return e?xn(e):""}let H=null,xe=null;const re="currentUserSession",Se="lastInteraction";try{const e=localStorage.getItem(re);if(e){const n=JSON.parse(e);n&&n.user&&n.expiresAt&&Number(n.expiresAt)>Date.now()?xe=n.user:localStorage.removeItem(re)}}catch{}function wn(){return H||[]}async function vn(){try{const e=await W("users.json");if(!e)return H=[];let n=null;if(e&&typeof e=="object"&&"json"in e)n=e.json;else try{n=JSON.parse(typeof e=="string"?e:String(e))}catch{n=null}if(Array.isArray(n)){H=n;try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}return H}if(n&&typeof n=="object"){try{H=Object.values(n)}catch{H=[]}try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}return H}return H=[]}catch(e){return console.warn("[users] fetchRemoteUsers failed",e),H=[]}}function jn(e){H=e;try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}}function kn(e,n){const s=wn(),o=s.findIndex(r=>r.username===e);return o===-1?!1:(s[o]={...s[o],...n},jn(s),!0)}function K(){return xe}function tt(e,n=1e3*60*60*3){xe=e;try{window.dispatchEvent(new CustomEvent("current-user-updated"))}catch{}try{if(e){const s=Date.now()+Number(n||0);localStorage.setItem(re,JSON.stringify({user:e,expiresAt:s})),localStorage.setItem(Se,String(Date.now()))}else localStorage.removeItem(re),localStorage.removeItem(Se)}catch{}}function Nn(){xe=null;try{window.dispatchEvent(new CustomEvent("current-user-updated"))}catch{}try{localStorage.removeItem(re),localStorage.removeItem(Se)}catch{}}const Sn=!0;function En(){return Sn}let me=null;function O(){if(me)return me;const e={index:[{id:"root",type:"folder",title:"Pages",children:[]}],docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:null,dirty:!1}};return me=e,e}function R(e){me=e;{try{console.log("[Appdata] updated (remote-only cache)",e)}catch{}try{window.dispatchEvent(new CustomEvent("appdata-updated",{detail:e}))}catch{}return}}function ee(e){e.syncMeta=e.syncMeta||{lastSync:null,dirty:!1},e.syncMeta.dirty=!0}function Ln(e,n,s="Untitled Page",o="<p>Start writing\x0026hellip;</p>"){const r="doc-"+Date.now();e.docs[r]={title:s,content:o,updatedAt:new Date().toISOString(),lastEditedBy:"System",modifiedBy:"System"},e.comments[r]={},e.history[r]=[];const a=nt(e.index,n)||e.index[0];a.children=a.children||[],a.children.push({id:r,type:"doc",title:s,initial:null}),ee(e),R(e);try{console.log("[Appdata:createDoc] Created doc",{id:r,title:s,parent:n,contentPreview:o.slice(0,40)})}catch{}return r}function nt(e,n){for(const s of e){if(s.id===n)return s;if(s.children){const o=nt(s.children,n);if(o)return o}}return null}function se(e){if(!e)return"<p>No content.</p>";const n=String(e).trim(),s=/^[a-zA-Z]:(\\|\/).+\.(png|jpg|jpeg|gif|bmp|webp)$/i,o=/ScreenClip[\\/].+\.(png|jpg|jpeg|gif|bmp|webp)$/i;return s.test(n)||o.test(n)||n.startsWith("file:///")?"<p>[Image or local file detected — content not embedded]</p>":!n.includes("<")&&n.length<260&&/\.(png|jpg|jpeg|gif|bmp|webp)$/i.test(n)?"<p>[Image reference removed]</p>":n}function Ue(){try{const e=K()||{};return e.id||e.email||e.name||"anonymous"}catch{return"anonymous"}}function Cn(e){return(e||"folder").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"folder"}function An(e){const n=[];function s(o,r){for(const a of o)if(a.type==="folder"){const i=Cn(a.title),u=[...r,i],h="root"+(u.length?"/"+u.join("/"):""),c=(a.children||[]).filter(l=>l.type==="doc").map(l=>({id:l.id,title:l.title,createdAt:new Date().toISOString(),modifiedAt:new Date().toISOString(),createdBy:Ue()}));n.push({id:a.id,type:"folder",path:h,title:a.title,createdAt:new Date().toISOString(),modifiedAt:new Date().toISOString(),createdBy:Ue(),pages:c}),s((a.children||[]).filter(l=>l.type==="folder"),u)}}return s(e,[]),n}async function Q(e){try{const n=An(e);En();try{window.dispatchEvent(new CustomEvent("root-updated",{detail:n}))}catch{}}catch(n){console.warn("[remoteFolders] updateRootTree local failed",n)}}function Fn(){const[e,n]=f.useState(!1);return f.useEffect(()=>{const s=document.documentElement;e?s.classList.add("dark"):s.classList.remove("dark")},[e]),t.jsxs("button",{className:"flex items-center gap-2 px-2 py-1 rounded border border-borderLight dark:border-[#1F2937] hover:bg-[#F4F5F7] dark:hover:bg-[#101828] transition",onClick:()=>n(s=>!s),title:"Toggle theme",children:[e?t.jsx(pt,{className:"w-4 h-4"}):t.jsx(gt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:e?"Light":"Dark"})]})}function Tn(){const[e,n]=f.useState("idle"),[s,o]=f.useState(!1),[r,a]=f.useState(null);f.useEffect(()=>{const h=l=>n(l.detail);window.addEventListener("sync-state",h);const c=setInterval(()=>{try{const l=window.__remoteSyncStatus;l&&(o(l.hasDirty),l.lastError&&a(l.lastError))}catch{}},4e3);return()=>{window.removeEventListener("sync-state",h),clearInterval(c)}},[]);let i=null,u="";return e==="bootstrap"?(i=t.jsx(yt,{className:"w-4 h-4 animate-pulse"}),u="Bootstrapping remote data"):e==="scheduled"?(i=t.jsx(Fe,{className:"w-4 h-4 animate-pulse"}),u="Changes queued for sync"):e==="flushing"?(i=t.jsx(Ve,{className:"w-4 h-4 animate-spin"}),u="Syncing with GitHub..."):r?(i=t.jsx(wt,{className:"w-4 h-4 text-amber-500"}),u="Sync warning: check console"):s?(i=t.jsx(Fe,{className:"w-4 h-4"}),u="Pending local changes"):(i=t.jsx(vt,{className:"w-4 h-4 text-emerald-500"}),u="All changes saved"),t.jsx("div",{className:"flex items-center gap-1 text-xs text-textSecondary dark:text-gray-400",title:u,children:i})}function Dn(){const e=f.useRef(null);return t.jsxs("header",{className:"h-14 bg-white dark:bg-[#0B0F1A] border-b border-borderLight dark:border-[#1F2937] flex items-center justify-between px-4",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("img",{src:"https://github.com/dizitalize/DocX/raw/main/logo.png",alt:"DocX Logo",className:"w-16 h-16",style:{objectFit:"contain"}})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Tn,{}),t.jsx(Fn,{}),t.jsx(Ye,{className:"w-5 h-5 cursor-pointer text-textSecondary dark:text-gray-300",onClick:()=>window.dispatchEvent(new CustomEvent("open-search"))}),t.jsx(xt,{className:"w-5 h-5 cursor-pointer text-textSecondary dark:text-gray-300"}),t.jsx("div",{ref:e,className:"w-8 h-8 rounded-full bg-[#DFE1E6] dark:bg-[#1F2937] flex items-center justify-center cursor-pointer",onClick:()=>window.dispatchEvent(new CustomEvent("open-user-profile")),children:t.jsx(bt,{className:"w-5 h-5 text-textSecondary dark:text-gray-300"})})]})]})}function st(e,n,s=[]){for(const o of e){const r=[...s,o];if(o.id===n)return r;if(o.children){const a=st(o.children,n,r);if(a)return a}}return null}function _(){const e=O().index;return Array.isArray(e)?e:[{id:"root",type:"folder",title:"Pages",children:[]}]}function ue(e){const n=O();n.index=e,R(n);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}}function Y(e,n){for(const s of e){if(s.id===n)return s;if(s.children){const o=Y(s.children,n);if(o)return o}}return null}function Ee(e,n){for(let s=0;s<e.length;s++){const o=e[s];if(o.id===n)return e.splice(s,1),o;if(o.children){const r=Ee(o.children,n);if(r)return r}}return null}function In(e,n,s){const o=Y(e,n);return o?(o.active=s,!0):!1}function we(e,n,s,o=-1){const r=Y(e,n);return!r||r.type!=="folder"?!1:(r.children=r.children||[],o>=0?r.children.splice(o,0,s):r.children.push(s),!0)}function Bn(e,n,s){const o=Y(e,n);return o?(o.title=s,!0):!1}const pe=[],fe={};let ve=!1;const On=7e3;function rt(e){fe[e.resource]&&clearTimeout(fe[e.resource]),fe[e.resource]=setTimeout(()=>{pe.find(n=>n.resource===e.resource)||pe.push(e),Pn(),delete fe[e.resource]},On)}function Z(){rt({resource:"index",type:"index"})}function Mn(e){rt({resource:`doc:${e}`,type:"doc",id:e})}async function Rn(e){try{e.type==="doc"&&e.id?await zn(e.id):e.type==="index"&&await $n()}catch(n){console.warn("[remoteSync] processTask failed",e,n)}}async function Pn(){if(!ve){for(ve=!0;pe.length;){const e=pe.shift();await Rn(e)}ve=!1}}function Un(e,n,s){const o=new Map,r=i=>o.set(i.id,{...i});(s||[]).forEach(i=>r(i)),(e||[]).forEach(i=>{o.has(i.id)||r(i)}),(n||[]).forEach(i=>r(i));const a=new Set((n||[]).map(i=>i.id).concat((s||[]).map(i=>i.id)));return Array.from(a).map(i=>o.get(i))}async function $n(){const e=O(),n=e.index||[];if(!n||n.length===0){console.error("[remoteSync] syncIndex: local index is empty, aborting putFile. This should never happen!");return}try{const s=await W("index.json");console.debug("[remoteSync] syncIndex: isRemoteEnabled=",X());const o=s?typeof s=="object"&&"json"in s?s.json:typeof s=="string"?JSON.parse(s):s:null,r=s&&typeof s=="object"&&"sha"in s?s.sha:void 0;if(!o){if(!X()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:"index",reason:"remote-writes-disabled"}}))}catch{}e.index=n,R(e);return}console.debug("[remoteSync] creating remote index.json");const c=await q("index.json",n);console.debug("[remoteSync] putFile create result",c);return}const a=Array.isArray(o)?o:o&&Array.isArray(o.index)?o.index:[],i=Array.isArray(n)?n:[];if(JSON.stringify(a)===JSON.stringify(i))return;const u=Un(a,i,a);if(console.log("[remoteSync] merged index to be saved:",u),!X()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:"index",reason:"remote-writes-disabled",merged:u}}))}catch{}e.index=u,R(e);return}console.debug("[remoteSync] updating remote index.json");const h=await q("index.json",u,r);console.debug("[remoteSync] putFile update result",h),e.index=u,R(e)}catch(s){console.warn("[remoteSync] syncIndex failed",s)}}async function zn(e){const n=O(),s=(n.docs||{})[e];if(s)try{const o=await W(`docs/${e}.json`),r=o?typeof o=="object"&&"json"in o?o.json:typeof o=="string"?JSON.parse(o):o:null,a=o&&typeof o=="object"&&"sha"in o?o.sha:void 0;if(!r){if(!X()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:`doc:${e}`,reason:"remote-writes-disabled"}}))}catch{}n.docs[e]=s,R(n);return}const l=await q(`docs/${e}.json`,s);console.debug("[remoteSync] putFile create doc result",l);return}if(JSON.stringify(r)===JSON.stringify(s))return;const i=new Date(s.updatedAt||0).getTime(),u=new Date(r.updatedAt||0).getTime(),h=i>=u?s:r;if(!X()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:`doc:${e}`,reason:"remote-writes-disabled",chosen:h}}))}catch{}n.docs[e]=h,R(n);return}const c=await q(`docs/${e}.json`,h,a);console.debug("[remoteSync] putFile update doc result",c),n.docs[e]=h,R(n)}catch(o){console.warn("[remoteSync] syncDoc failed",e,o)}}async function Hn(e){return!1}function ot({node:e,depth:n=0,onDragStart:s,onDrop:o,onDragOver:r,onDelete:a,onCreateDoc:i,onCreateFolder:u,onRename:h,autoEditId:c}){var T;const[l,m]=f.useState(!0),[v,x]=f.useState(c===e.id),[N,d]=f.useState(e.title),p=f.useRef(null),k=ut();f.useEffect(()=>{x(c===e.id),d(e.title)},[c,e.id,e.title,k.pathname]),f.useEffect(()=>{c&&Y([e],c)&&m(!0)},[c,e]),f.useEffect(()=>{v&&p.current&&(p.current.focus(),p.current.select())},[v]);const A=8+n*12;return e.type==="folder"?t.jsxs("div",{className:"select-none",children:[t.jsxs("div",{className:"group flex items-center gap-2 px-3 py-1.5 text-[15px] text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-[#181f2a] cursor-pointer rounded-lg transition-all shadow-sm",style:{paddingLeft:A,minHeight:36,fontWeight:500,letterSpacing:.1},draggable:!0,onDragStart:b=>s(b,e),onDragOver:b=>r(b,e),onDrop:b=>o(b,e),onClick:()=>m(b=>!b),children:[t.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-md bg-gray-200 dark:bg-[#232b3b] mr-1",children:l?t.jsx(jt,{className:"w-3.5 h-3.5"}):t.jsx(kt,{className:"w-3.5 h-3.5"})}),t.jsx(Te,{className:"w-4 h-4 text-blue-500 dark:text-blue-400"}),t.jsx("div",{className:"flex-1 min-w-0 flex items-center gap-1",children:v?t.jsx("input",{ref:p,value:N,onChange:b=>d(b.target.value),onBlur:()=>{N.trim()&&N!==e.title&&(h==null||h(e.id,N.trim())),x(!1),d(e.title)},onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.currentTarget.blur()),b.key==="Escape"&&(x(!1),d(e.title))},className:"w-full bg-transparent outline-none text-gray-800 dark:text-gray-100 text-[15px] px-1 rounded border border-gray-200 dark:border-[#232b3b] focus:border-blue-400 dark:focus:border-blue-500",style:{minWidth:0}}):t.jsx("span",{onDoubleClick:()=>x(!0),className:"truncate font-medium",style:{minWidth:0},children:e.title})}),e.id!=="root"&&t.jsx("button",{title:"Delete",onClick:b=>{b.stopPropagation(),a==null||a(e.id)},className:"opacity-0 group-hover:opacity-100 transition p-1 rounded hover:bg-red-50 dark:hover:bg-[#2a1a1a] ml-1",children:t.jsx(De,{className:"w-4 h-4 text-red-400"})}),t.jsxs("div",{className:"flex gap-1 ml-1 opacity-0 group-hover:opacity-100 transition",children:[t.jsx("button",{title:"New page",onClick:b=>{b.stopPropagation(),i==null||i(e.id)},className:"p-1 rounded hover:bg-blue-50 dark:hover:bg-[#1a2233]",children:t.jsx(Qe,{className:"w-4 h-4 text-blue-500"})}),t.jsx("button",{title:"New folder",onClick:b=>{b.stopPropagation(),u==null||u(e.id)},className:"p-1 rounded hover:bg-blue-50 dark:hover:bg-[#1a2233]",children:t.jsx(Te,{className:"w-4 h-4 text-blue-400"})}),t.jsx("button",{title:"Rename",onClick:b=>{b.stopPropagation(),x(!0)},className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-[#232b3b]",children:t.jsx(Nt,{className:"w-4 h-4 text-gray-400"})})]})]}),l&&((T=e.children)==null?void 0:T.filter(b=>b.active!==!1).map(b=>t.jsx(ot,{node:b,depth:n+1,onDragStart:s,onDragOver:r,onDrop:o,onDelete:a,onCreateDoc:i,onCreateFolder:u,onRename:h,autoEditId:c},b.id)))]}):t.jsxs(ft,{to:`/docs/${e.id}`,draggable:!0,onDragStart:b=>s(b,e),onDragOver:b=>r(b,e),onDrop:b=>o(b,e),className:({isActive:b})=>`group flex items-center gap-2 px-3 py-1.5 rounded-lg text-[15px] hover:bg-gray-100 dark:hover:bg-[#181f2a] transition shadow-sm ${b?"bg-white dark:bg-[#232b3b] shadow":"text-gray-700 dark:text-gray-200"}`,style:{paddingLeft:A,minHeight:36,fontWeight:500,letterSpacing:.1},children:[t.jsx(St,{className:"w-4 h-4 text-green-500 dark:text-green-400"}),t.jsx("div",{className:"flex-1 min-w-0 flex items-center gap-1",children:v?t.jsx("input",{ref:p,value:N,onChange:b=>d(b.target.value),onBlur:()=>{x(!1),N.trim()&&N!==e.title&&(h==null||h(e.id,N.trim()))},onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.currentTarget.blur()),b.key==="Escape"&&(x(!1),d(e.title))},className:"w-full bg-transparent outline-none text-gray-800 dark:text-gray-100 text-[15px] px-1 rounded border border-gray-200 dark:border-[#232b3b] focus:border-green-400 dark:focus:border-green-500",style:{minWidth:0}}):t.jsx("span",{onDoubleClick:()=>x(!0),className:"truncate font-medium",style:{minWidth:0},children:e.title})}),t.jsx("button",{title:"Delete",onClick:b=>{b.preventDefault(),a==null||a(e.id)},className:"opacity-0 group-hover:opacity-100 transition p-1 rounded hover:bg-red-50 dark:hover:bg-[#2a1a1a] ml-1",children:t.jsx(De,{className:"w-4 h-4 text-red-400"})})]})}function Wn({open:e,onClose:n,target:s,docs:o,onConfirm:r}){if(!e)return null;const a=(s==null?void 0:s.type)==="folder";return t.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-32 bg-black/30 backdrop-blur-sm",children:t.jsxs("div",{className:"w-[520px] bg-white dark:bg-[#0F172A] rounded shadow-lg border border-borderLight dark:border-[#1F2937]",children:[t.jsx("div",{className:"px-5 py-4 border-b border-borderLight dark:border-[#1F2937] flex items-center justify-between",children:t.jsxs("h2",{className:"text-lg font-semibold",children:["Delete ",a?"Folder":"Page"]})}),t.jsxs("div",{className:"px-5 pt-4 pb-5 text-sm max-h-[360px] overflow-y-auto",children:[a?t.jsx("p",{className:"mb-3 text-textSecondary dark:text-gray-400",children:"You're about to delete this folder and all pages inside it. The following pages will be permanently removed:"}):t.jsx("p",{className:"mb-3 text-textSecondary dark:text-gray-400",children:"You're about to delete this page permanently:"}),t.jsxs("table",{className:"w-full text-left text-xs border border-borderLight dark:border-[#1F2937] rounded overflow-hidden",children:[t.jsx("thead",{className:"bg-[#F4F5F7] dark:bg-[#101828] text-textSecondary dark:text-gray-300",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-2 font-medium",children:"Title"}),t.jsx("th",{className:"py-2 px-2 font-medium w-32",children:"Last Edited By"}),t.jsx("th",{className:"py-2 px-2 font-medium w-40",children:"Updated"})]})}),t.jsx("tbody",{children:o.map(i=>{var v;const u=O(),h=((v=u==null?void 0:u.docs)==null?void 0:v[i.id])||null,c=(h==null?void 0:h.title)||i.title||"Untitled";let l=(h==null?void 0:h.lastEditedBy)||i.lastEditedBy||null,m="-";if(l&&(u!=null&&u.users)&&typeof u.users=="object"){const x=u.users[l];x?m=x.name||x.username||x.email||l:m=l}else l&&(m=l);return t.jsxs("tr",{className:"border-t border-borderLight dark:border-[#1F2937]",children:[t.jsx("td",{className:"py-1.5 px-2 text-[13px] truncate",children:c}),t.jsx("td",{className:"py-1.5 px-2 text-[13px]",children:m}),t.jsx("td",{className:"py-1.5 px-2 text-[11px] text-textSecondary dark:text-gray-400",children:h!=null&&h.updatedAt?new Date(h.updatedAt).toLocaleString():"-"})]},i.id)})})]})]}),t.jsxs("div",{className:"px-5 py-3 bg-[#F4F5F7] dark:bg-[#101828] border-t border-borderLight dark:border-[#1F2937] flex justify-end gap-2",children:[t.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A] hover:bg-[#EBECF0] dark:hover:bg-[#162032] transition",children:"Cancel"}),t.jsx("button",{onClick:r,className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:brightness-110 transition",children:"Delete"})]})]})})}function je(e){try{localStorage.setItem("sidebarTree",JSON.stringify(e))}catch{}}function $e(){try{const e=localStorage.getItem("sidebarTree");return e?JSON.parse(e):null}catch{return null}}function ze(e,n){let s;do s=e+"-"+Date.now()+"-"+Math.floor(Math.random()*1e6);while(Y(n,s));return s}function _n({collapsed:e,setCollapsed:n}){var M;const s=(y,g)=>{r(C=>{const L=structuredClone(C);if(!Bn(L,y,g))return C;ue(L),Q(L);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}return L})},[o,r]=f.useState(()=>{const y=$e();if(y&&Array.isArray(y)&&y.length>0&&!(y.length===1&&y[0].id==="root"&&(!y[0].children||y[0].children.length===0)))return y;const g=_();return g&&Array.isArray(g)&&g.length>0&&!(g.length===1&&g[0].id==="root"&&(!g[0].children||g[0].children.length===0))?g:[{id:"root",type:"folder",title:"Pages",children:[]}]}),[a,i]=f.useState(()=>$e()||_()),[u,h]=f.useState(!1),c=Ae(),l=((M=o[0])==null?void 0:M.id)||"root",m=y=>{r([...y]),ue(y)},[v,x]=f.useState(null),[N,d]=f.useState(!1),[p,k]=f.useState(null),[A,T]=f.useState(null),[b,I]=f.useState(256),w=180,D=480,B=f.useRef(null),U=f.useRef(!1);f.useEffect(()=>{function y(C){var P;if(!U.current)return;let L=C.clientX-(((P=B.current)==null?void 0:P.getBoundingClientRect().left)||0);L<w&&(L=w),L>D&&(L=D),I(L)}function g(){U.current=!1}return window.addEventListener("mousemove",y),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",g)}},[]),f.useEffect(()=>{const y=()=>{const g=_();r(g),je(g),i(g),h(!1)};return window.addEventListener("docs-index-updated",y),X()&&W("index.json").then(g=>{g&&g.json&&(r(g.json),je(g.json),i(g.json),h(!1)),g!=null&&g.sha&&T(g.sha)}).catch(()=>{}),()=>window.removeEventListener("docs-index-updated",y)},[]),f.useEffect(()=>{je(o),h(JSON.stringify(o)!==JSON.stringify(a))},[o,a]),f.useEffect(()=>{const y=setInterval(async()=>{const g=o.length===1&&o[0].id==="root"&&(!o[0].children||o[0].children.length===0);if(JSON.stringify(o)!==JSON.stringify(a)&&!g){if(o.length===1&&o[0].id==="root"&&(!o[0].children||o[0].children.length===0))return;try{await q("index.json",o),i(o),h(!1)}catch{}}},1e4);return()=>clearInterval(y)},[o,a]);const oe=(y=l)=>{r(g=>{const C=O(),L=ze("doc",g),P={id:L,type:"doc",title:"Untitled Page",initial:{content:"<p>Start writing…</p>"}};C.docs[L]={title:P.title,content:P.initial.content,updatedAt:new Date().toISOString(),lastEditedBy:"Unknown"},C.history[L]=[],C.comments[L]=[];const z=structuredClone(g);return we(z,y,P),ue(z),Q(z),k(L),q(`docs/${L}.json`,C.docs[L]),c(`/docs/${L}`),z})},ae=(y=l)=>{r(g=>{const C=ze("folder",g),L={id:C,type:"folder",title:"Untitled Folder",active:!0,children:[]},P=structuredClone(g);we(P,y,L),ue(P),Q(P),k(C);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}return P})},te=y=>{const g=[],C=L=>{L.type==="doc"&&g.push(L),L.children&&L.children.forEach(C)};return C(y),g},V=y=>{const g=Y(o,y);!g||g.id===l||(x(g),d(!0))},be=()=>{if(!v)return;const y=structuredClone(o);if(In(y,v.id,!1)){Ee(y,v.id);const C=O();m(y),R(C),Q(y),p===v.id&&k(null)}d(!1),x(null)};let J=null;const S=(y,g)=>{J=g,y.dataTransfer.effectAllowed="move"},E=y=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},j=(y,g)=>{if(y.preventDefault(),!J||J.id===g.id||J.active===!1)return;const C=structuredClone(o),L=Ee(C,J.id);if(L){if(g.type==="folder")we(C,g.id,L);else{const P=[{parent:null,list:C}];for(;P.length;){const{parent:z,list:ye}=P.pop();for(let ie=0;ie<ye.length;ie++){const ce=ye[ie];if(ce.id===g.id){if(z){const ct=z.children.findIndex(lt=>lt.id===g.id);z.children.splice(ct+1,0,L)}else ye.splice(ie+1,0,L);m(C),Q(C),Z();return}ce.children&&P.push({parent:ce,list:ce.children})}}}m(C),Q(C),Z()}};return t.jsx(t.Fragment,{children:t.jsxs("aside",{ref:B,className:`bg-sidebarBg dark:bg-[#0B1220] border-r border-borderLight dark:border-[#1F2937] min-h-[calc(100vh-56px)] transition-all duration-150 ease-in-out relative ${e?"w-12":""}`,style:{width:e?48:b,minWidth:e?48:180,maxWidth:e?48:480},onMouseLeave:Z,children:[t.jsxs("button",{className:"absolute top-3 -right-3 z-30 w-7 h-7 flex items-center justify-center bg-white dark:bg-[#101828] border border-borderLight dark:border-[#1F2937] rounded-full shadow-lg hover:bg-gray-100 dark:hover:bg-[#22223b] transition focus:outline-none",style:{boxShadow:"0 2px 8px #0002",borderWidth:"2px"},onClick:()=>n&&n(y=>!y),tabIndex:-1,children:[t.jsx("span",{className:"sr-only",children:e?"Expand sidebar":"Collapse sidebar"}),t.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 16 16",children:t.jsx("path",{d:e?"M6 4l4 4-4 4":"M10 4L6 8l4 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),!e&&t.jsx("div",{className:"absolute top-0 right-0 h-full w-2 cursor-col-resize z-10",style:{userSelect:"none"},onMouseDown:()=>{U.current=!0}}),t.jsxs("div",{className:`flex flex-col h-full ${e?"items-center":""}`,children:[t.jsx("div",{className:`px-3 py-2 text-xs font-semibold text-textSecondary dark:text-gray-400 uppercase tracking-wide ${e?"hidden":""}`,children:"Pages"}),t.jsxs("div",{className:`px-3 pb-2 flex gap-2 ${e?"hidden":""}`,children:[t.jsxs("button",{onClick:oe,className:"flex-1 flex items-center gap-2 bg-white dark:bg-[#0F172A] border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 text-sm hover:shadow transition",children:[t.jsx(Qe,{className:"w-4 h-4"})," New page"]}),t.jsx("button",{onClick:()=>{ae(),Z()},className:"px-3 py-2 bg-white dark:bg-[#0F172A] border border-borderLight dark:border-[#1F2937] rounded text-sm hover:shadow transition",title:"New folder",children:t.jsx(Et,{className:"w-4 h-4"})})]}),t.jsx("div",{className:`px-3 py-2 text-xs font-semibold text-textSecondary dark:text-gray-400 uppercase tracking-wide ${e?"hidden":""}`,children:"Page tree"}),t.jsx("nav",{className:`px-1 overflow-y-auto max-h-[calc(100vh-56px-110px)] pb-4 flex-1 ${e?"hidden":""}`,children:o.filter(y=>y.active!==!1).map(y=>t.jsx(ot,{node:y,onDragStart:S,onDragOver:E,onDrop:j,onDelete:V,onCreateDoc:oe,onCreateFolder:ae,onRename:(g,C)=>{s(g,C),Z()},autoEditId:p},y.id))}),t.jsx(Wn,{open:N,onClose:()=>{d(!1),x(null)},target:v,docs:v?te(v):[],onConfirm:()=>{be(),Z()}})]})]})})}const Jn=Xt.create({name:"image",group:"inline",inline:!0,draggable:!0,selectable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:"auto"},height:{default:"auto"},style:{default:null}}},parseHTML(){return[{tag:"img[src]"}]},renderHTML({HTMLAttributes:e}){return["img",qt(e)]},addNodeView(){return({node:e,getPos:n,editor:s,selected:o})=>{const r=document.createElement("img");r.src=e.attrs.src,r.alt=e.attrs.alt||"",r.title=e.attrs.title||"",r.style.width=e.attrs.width||"auto",r.style.height=e.attrs.height||"auto",r.style.maxWidth="100%",r.style.cursor="pointer",r.draggable=!1,r.tabIndex=0;const a=document.createElement("span");a.style.position="relative",a.style.display="inline-block",a.style.verticalAlign="middle";function i(c){c.stopPropagation();const{state:l,view:m}=s,v=n();typeof v=="number"&&setTimeout(()=>{const x=l.tr.setSelection(Kt.create(l.doc,v));m.dispatch(x)},0)}r.addEventListener("click",i),r.addEventListener("contextmenu",c=>{i(c),c.preventDefault()}),a.addEventListener("click",c=>{i(c)});function u(c){r.style.outline=c?"2px solid #3182ce":"none",r.style.outlineOffset=c?"2px":"0";for(const l of a.querySelectorAll(".resize-handle"))l.style.display=c?"block":"none"}return[{x:0,y:0,cursor:"nwse-resize",name:"top-left"},{x:100,y:0,cursor:"nesw-resize",name:"top-right"},{x:100,y:100,cursor:"nwse-resize",name:"bottom-right"},{x:0,y:100,cursor:"nesw-resize",name:"bottom-left"}].forEach(c=>{const l=document.createElement("div");l.className="resize-handle",l.contentEditable="false",l.setAttribute("data-handle",c.name),l.setAttribute("role","slider"),l.setAttribute("aria-label",`Resize image ${c.name}`),l.tabIndex=0,l.style.left=`calc(${c.x}% - 6px)`,l.style.top=`calc(${c.y}% - 6px)`,l.setAttribute("aria-hidden",o?"false":"true"),l.style.cursor=c.cursor,l.addEventListener("mousedown",m=>{m.preventDefault(),m.stopPropagation();const v=m.clientX;m.clientY;const x=r.offsetWidth,N=r.offsetHeight,d=x/N||1;function p(A){let T=0;c.name.includes("left")?T=v-A.clientX:T=A.clientX-v;let b=Math.max(32,Math.round(x+T)),I=Math.max(32,Math.round(b/d));r.style.width=b+"px",r.style.height=I+"px"}function k(){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",k);const A=s.state.tr.setNodeMarkup(n(),void 0,{...e.attrs,width:r.style.width,height:r.style.height});s.view.dispatch(A)}document.addEventListener("mousemove",p),document.addEventListener("mouseup",k)}),l.addEventListener("keydown",m=>{const v=m.shiftKey?10:1,x=r.offsetWidth,N=r.offsetHeight;let d=x,p=N;if(m.key==="ArrowRight"&&(d=x+v),m.key==="ArrowLeft"&&(d=Math.max(32,x-v)),m.key==="ArrowDown"&&(p=N+v),m.key==="ArrowUp"&&(p=Math.max(32,N-v)),m.key==="Enter"){const k=s.state.tr.setNodeMarkup(n(),void 0,{...e.attrs,width:r.style.width,height:r.style.height});s.view.dispatch(k)}else r.style.width=d+"px",r.style.height=p+"px",m.preventDefault()}),a.appendChild(l)}),a.appendChild(r),u(!!o),{dom:a,contentDOM:null,update:(c,l,m)=>(u(!!m),!0)}}}}),Xn=Yt.extend({addNodeView(){return({node:e,getPos:n,editor:s,selected:o})=>{const r=document.createElement("div");r.style.position="relative",r.style.display="block",r.style.width="100%",r.style.boxSizing="border-box";const a=document.createElement("div");a.style.display="block",r.appendChild(a);let i=[];function u(){i.forEach(m=>m.remove()),i=[]}function h(m,v,x,N){const d=document.createElement("div");return d.className="table-resize-handle",d.setAttribute("data-handle",N),d.style.left=`calc(${m}% - 6px)`,d.style.top=`calc(${v}% - 6px)`,d.style.cursor=x,d.tabIndex=0,d.setAttribute("role","slider"),d.setAttribute("aria-label",`Resize table ${N}`),d.setAttribute("aria-hidden",o?"false":"true"),d}function c(){const m=a.querySelector("table");if(!m){u();return}u(),[{x:0,y:0,cursor:"nwse-resize",name:"top-left"},{x:50,y:0,cursor:"ns-resize",name:"top-center"},{x:100,y:0,cursor:"nesw-resize",name:"top-right"},{x:100,y:50,cursor:"ew-resize",name:"middle-right"},{x:100,y:100,cursor:"nwse-resize",name:"bottom-right"},{x:50,y:100,cursor:"ns-resize",name:"bottom-center"},{x:0,y:100,cursor:"nesw-resize",name:"bottom-left"},{x:0,y:50,cursor:"ew-resize",name:"middle-left"}].forEach(x=>{const N=h(x.x,x.y,x.cursor,x.name);N.addEventListener("mousedown",d=>{d.preventDefault(),d.stopPropagation();const p=d.clientX,k=d.clientY,A=m.offsetWidth,T=m.offsetHeight;function b(w){let D=A,B=T;x.name.includes("left")&&(D=Math.max(64,A-(w.clientX-p))),x.name.includes("right")&&(D=Math.max(64,A+(w.clientX-p))),x.name.includes("top")&&(B=Math.max(32,T-(w.clientY-k))),x.name.includes("bottom")&&(B=Math.max(32,T+(w.clientY-k))),m.style.width=D+"px",m.style.height=B+"px"}function I(){document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",I);try{const w=n();if(typeof w=="number"){const D={...e.attrs};D.style=m.getAttribute("style")||"";const B=s.state.tr.setNodeMarkup(w,void 0,D);s.view.dispatch(B)}}catch{}}document.addEventListener("mousemove",b),document.addEventListener("mouseup",I)}),N.addEventListener("keydown",d=>{const p=d.shiftKey?10:1,k=m.offsetWidth,A=m.offsetHeight;let T=k,b=A;if(d.key==="ArrowRight"&&(T=k+p),d.key==="ArrowLeft"&&(T=Math.max(64,k-p)),d.key==="ArrowDown"&&(b=A+p),d.key==="ArrowUp"&&(b=Math.max(32,A-p)),m.style.width=T+"px",m.style.height=b+"px",d.key==="Enter")try{const I=n();if(typeof I=="number"){const w={...e.attrs};w.style=m.getAttribute("style")||"";const D=s.state.tr.setNodeMarkup(I,void 0,w);s.view.dispatch(D)}}catch{}d.preventDefault()}),r.appendChild(N),i.push(N)})}const l=new MutationObserver(c);return l.observe(a,{childList:!0,subtree:!0}),setTimeout(c,20),{dom:r,contentDOM:a,update:(m,v,x)=>(i.forEach(N=>N.setAttribute("aria-hidden",x?"false":"true")),c(),!0),destroy:()=>l.disconnect()}}}}),F=Xe.memo(function({onClick:n,active:s,title:o,children:r}){return t.jsx("button",{title:o,onClick:n,className:`p-2 rounded hover:bg-[#EBECF0] dark:hover:bg-[#101828] transition ${s?"bg-[#EBECF0] dark:bg-[#101828]":""}`,type:"button",children:r})});function qn({editor:e}){if(!e)return null;const n=r=>()=>{r(e.chain().focus()).run()},s=()=>{const r=prompt("Enter URL");r&&e.chain().focus().setLink({href:r}).run()},o=()=>{const r=prompt("Image URL (must end with .jpg, .jpeg, .png, .gif, .webp, .svg) or base64:");if(!r)return;const a=r.startsWith("data:image/"),i=/\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i.test(r);if(!a&&!i){alert("Please enter a direct image URL ending with .jpg, .jpeg, .png, .gif, .webp, .svg or a base64 image.");return}e.chain().focus().setImage({src:r}).run()};return t.jsx("div",{className:"sticky top-14 z-30 bg-toolbarBg dark:bg-[#0B0F1A] border-b border-borderLight dark:border-[#1F2937] shadow-toolbar",children:t.jsxs("div",{className:"max-w-5xl mx-auto flex items-center gap-1 px-3 h-11",children:[t.jsx(F,{title:"Bold",onClick:n(r=>r.toggleBold()),active:e.isActive("bold"),children:t.jsx(Lt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Italic",onClick:n(r=>r.toggleItalic()),active:e.isActive("italic"),children:t.jsx(Ct,{className:"w-4 h-4"})}),t.jsx(F,{title:"Underline",onClick:n(r=>{var a;return(a=r.toggleUnderline)==null?void 0:a.call(r)}),active:e.isActive("underline"),children:t.jsx(At,{className:"w-4 h-4"})}),t.jsx(F,{title:"Strike",onClick:n(r=>r.toggleStrike()),active:e.isActive("strike"),children:t.jsx(Ft,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Heading",onClick:n(r=>r.toggleHeading({level:2})),active:e.isActive("heading",{level:2}),children:t.jsx(Tt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Bulleted list",onClick:n(r=>r.toggleBulletList()),active:e.isActive("bulletList"),children:t.jsx(Dt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Numbered list",onClick:n(r=>r.toggleOrderedList()),active:e.isActive("orderedList"),children:t.jsx(It,{className:"w-4 h-4"})}),t.jsx(F,{title:"Checklist",onClick:n(r=>r.toggleTaskList()),active:e.isActive("taskList"),children:t.jsx(Bt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Quote",onClick:n(r=>r.toggleBlockquote()),active:e.isActive("blockquote"),children:t.jsx(Ot,{className:"w-4 h-4"})}),t.jsx(F,{title:"Rule",onClick:n(r=>r.setHorizontalRule()),children:t.jsx(Mt,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Code block",onClick:n(r=>r.toggleCodeBlock()),active:e.isActive("codeBlock"),children:t.jsx(Rt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Link",onClick:s,active:e.isActive("link"),children:t.jsx(Pt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Image",onClick:o,children:t.jsx(Ut,{className:"w-4 h-4"})}),t.jsx(F,{title:"Insert table",onClick:n(r=>r.insertTable({rows:3,cols:4,withHeaderRow:!0})),children:t.jsx($t,{className:"w-4 h-4"})}),t.jsx(F,{title:"Add row",onClick:n(r=>r.addRowAfter()),children:t.jsx("span",{className:"text-xs",children:"+Row"})}),t.jsx(F,{title:"Del row",onClick:n(r=>r.deleteRow()),children:t.jsx("span",{className:"text-xs",children:"-Row"})}),t.jsx(F,{title:"Add col",onClick:n(r=>r.addColumnAfter()),children:t.jsx("span",{className:"text-xs",children:"+Col"})}),t.jsx(F,{title:"Del col",onClick:n(r=>r.deleteColumn()),children:t.jsx("span",{className:"text-xs",children:"-Col"})}),t.jsx(F,{title:"Del table",onClick:n(r=>r.deleteTable()),children:t.jsx("span",{className:"text-xs",children:"XTbl"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Search (Ctrl+K)",onClick:()=>window.dispatchEvent(new CustomEvent("open-search")),children:t.jsx(Ye,{className:"w-4 h-4"})}),t.jsx(F,{title:"Comments",onClick:()=>window.dispatchEvent(new CustomEvent("open-comments")),children:t.jsx(zt,{className:"w-4 h-4"})}),t.jsx(F,{title:"History",onClick:()=>window.dispatchEvent(new CustomEvent("open-history")),children:t.jsx(Ht,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Undo",onClick:n(r=>r.undo()),children:t.jsx(Wt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Redo",onClick:n(r=>r.redo()),children:t.jsx(_t,{className:"w-4 h-4"})})]})})}const Kn=new Map;function Yn(e){return`draftAutosave:${e}`}function Vn(e){try{const n=Kn.get(Yn(e));return!!(n&&String(n).trim().length>0)}catch{return!1}}function Qn({docId:e}){return Vn(e)?t.jsx("span",{className:"ml-2 inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 border border-amber-300 text-amber-700 rounded bg-amber-50 dark:bg-[#2B1B00] dark:border-amber-600 dark:text-amber-300",children:"Draft saved"}):null}const Zn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Gn=(e=21)=>{let n="",s=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)n+=Zn[s[e]&63];return n};const es=Vt.create({name:"blockId",addGlobalAttributes(){return[{types:["paragraph","heading","blockquote","codeBlock"],attributes:{"data-block-id":{default:null,rendered:!0,parseHTML:e=>e.getAttribute("data-block-id"),renderHTML:e=>({"data-block-id":e["data-block-id"]||Gn(8)})}}}]}});function ts(e,n){const s=O();s.history[e]=s.history[e]||[],s.history[e].unshift({...n,ts:Date.now()}),s.history[e]=s.history[e].slice(0,50),ee(s),R(s)}function ns(e){return O().history[e]||[]}function ss({open:e,onClose:n,history:s=[],onRestore:o}){return e?t.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex",children:t.jsxs("div",{className:"ml-auto w-[420px] h-full bg-white dark:bg-[#0B0F1A] border-l border-borderLight dark:border-[#1F2937] p-4 overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold",children:"Version history"}),t.jsx("button",{onClick:n,className:"text-sm underline",children:"Close"})]}),s.length===0?t.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}):s.map((r,a)=>t.jsxs("div",{className:"border border-borderLight dark:border-[#1F2937] rounded p-3 mb-3",children:[t.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[new Date(r.ts).toLocaleString()," 5 ",r.user||"Unknown"]}),t.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:r.content}}),t.jsx("div",{className:"mt-2",children:t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:()=>o(r),children:"Restore"})})]},a))]})}):null}function at(e,n=[]){for(const s of e)s.type==="doc"&&n.push(s),s.children&&at(s.children,n);return n}function rs(e){const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""}function os({open:e,onClose:n}){const[s,o]=f.useState(""),r=Ae(),a=_(),i=at(a),u=f.useMemo(()=>{if(!s.trim())return[];const c=s.toLowerCase();return i.map(l=>{var d;const v=loadAppdata().docs[l.id]||{},x=se(v.content||((d=l.initial)==null?void 0:d.content)||"");return`${l.title} ${rs(x)}`.toLowerCase().includes(c)?{id:l.id,title:v.title||l.title}:null}).filter(Boolean).slice(0,30)},[s]),h=c=>{n(),r(`/docs/${c}`)};return f.useEffect(()=>{const c=l=>{l.key==="Escape"&&n()};return e&&window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[e]),e?t.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-start justify-center pt-24",children:t.jsxs("div",{className:"w-[640px] bg-white dark:bg-[#0B0F1A] rounded border border-borderLight dark:border-[#1F2937] p-4",children:[t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-3 bg-white dark:bg-[#0F172A]",placeholder:"Search pages and content…",value:s,onChange:c=>o(c.target.value),autoFocus:!0}),t.jsxs("div",{className:"max-h-[50vh] overflow-y-auto",children:[u.map(c=>t.jsx("div",{onClick:()=>h(c.id),className:"px-2 py-2 rounded cursor-pointer hover:bg-[#F4F5F7] dark:hover:bg-[#101828]",children:c.title},c.id)),s&&u.length===0&&t.jsx("div",{className:"text-sm text-gray-500 px-2 py-2",children:"No results"})]})]})}):null}function it({open:e,onClose:n}){const[s,o]=f.useState(K()),[r,a]=f.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||""}),[i,u]=f.useState("");if(f.useEffect(()=>{if(e){const c=K();o(c),a({name:(c==null?void 0:c.name)||"",email:(c==null?void 0:c.email)||""})}},[e]),!e)return null;const h=()=>{const c=r.name.trim()||"Unnamed",l=r.email.trim();kn(s.username,{name:c,email:l}),tt({...s,name:c,email:l}),u("Profile updated!"),setTimeout(()=>u(""),2e3)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black bg-opacity-20",children:t.jsxs("div",{className:"relative mt-12 w-full max-w-lg bg-white dark:bg-[#101828] rounded-xl shadow-2xl p-8 border border-borderLight dark:border-[#1F2937] animate-fade-in",children:[t.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-700 dark:hover:text-white p-1 rounded-full focus:outline-none",children:t.jsx(Jt,{className:"w-6 h-6"})}),t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"User Settings"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),t.jsx("input",{className:"w-full text-base px-3 py-2 rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A]",value:r.name,onChange:c=>a(l=>({...l,name:c.target.value})),placeholder:"Name"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),t.jsx("input",{className:"w-full text-base px-3 py-2 rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A]",value:r.email,onChange:c=>a(l=>({...l,email:c.target.value})),placeholder:"Email"})]}),t.jsx("button",{onClick:h,className:"px-5 py-2 rounded bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition",children:"Save"}),i&&t.jsx("div",{className:"mt-3 text-green-600 dark:text-green-400",children:i})]})})}function as({open:e,onClose:n,anchorRef:s}){var c;const[o,r]=f.useState(K()),[a,i]=f.useState(!1),u=f.useRef(null);if(f.useEffect(()=>{const l=()=>r(K());return window.addEventListener("current-user-updated",l),()=>window.removeEventListener("current-user-updated",l)},[]),f.useEffect(()=>{if(!e)return;function l(m){u.current&&!u.current.contains(m.target)&&(!s||!s.current||!s.current.contains(m.target))&&n()}return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[e,n,s]),a)return t.jsx(it,{open:a,onClose:()=>i(!1)});if(!e||!o)return null;let h={position:"absolute",top:60,right:24,zIndex:1e3};if(s&&s.current){const l=s.current.getBoundingClientRect();h={position:"absolute",top:l.bottom+8+window.scrollY,left:l.left+window.scrollX-180+l.width/2,zIndex:1e3}}return t.jsxs("div",{ref:u,style:h,className:"bg-white dark:bg-[#101828] rounded-xl shadow-2xl border border-borderLight dark:border-[#1F2937] w-80 p-5 flex flex-col gap-2 animate-fade-in",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-atlassianBlue to-blue-400 flex items-center justify-center text-white text-xl font-bold uppercase shadow-sm",children:((c=o.username)==null?void 0:c.slice(0,2))||"U"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-lg",children:o.name||o.username}),t.jsx("div",{className:"text-xs text-textSecondary dark:text-gray-400",children:o.email||"—"}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Role: ",t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:o.role||"user"})]})]})]}),t.jsx("button",{onClick:()=>{i(!0),n()},className:"px-4 py-2 rounded bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition mt-2",children:"Settings"}),t.jsx("button",{onClick:()=>{Nn(),n()},className:"px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 font-semibold shadow hover:bg-gray-300 dark:hover:bg-gray-600 transition mt-1",children:"Sign Out"})]})}var is="Expected a function",He=NaN,cs="[object Symbol]",ls=/^\s+|\s+$/g,ds=/^[-+]0x[0-9a-f]+$/i,us=/^0b[01]+$/i,fs=/^0o[0-7]+$/i,hs=parseInt,ms=typeof le=="object"&&le&&le.Object===Object&&le,ps=typeof self=="object"&&self&&self.Object===Object&&self,gs=ms||ps||Function("return this")(),xs=Object.prototype,bs=xs.toString,ys=Math.max,ws=Math.min,ke=function(){return gs.Date.now()};function vs(e,n,s){var o,r,a,i,u,h,c=0,l=!1,m=!1,v=!0;if(typeof e!="function")throw new TypeError(is);n=We(n)||0,Le(s)&&(l=!!s.leading,m="maxWait"in s,a=m?ys(We(s.maxWait)||0,n):a,v="trailing"in s?!!s.trailing:v);function x(w){var D=o,B=r;return o=r=void 0,c=w,i=e.apply(B,D),i}function N(w){return c=w,u=setTimeout(k,n),l?x(w):i}function d(w){var D=w-h,B=w-c,U=n-D;return m?ws(U,a-B):U}function p(w){var D=w-h,B=w-c;return h===void 0||D>=n||D<0||m&&B>=a}function k(){var w=ke();if(p(w))return A(w);u=setTimeout(k,d(w))}function A(w){return u=void 0,v&&o?x(w):(o=r=void 0,i)}function T(){u!==void 0&&clearTimeout(u),c=0,o=h=r=u=void 0}function b(){return u===void 0?i:A(ke())}function I(){var w=ke(),D=p(w);if(o=arguments,r=this,h=w,D){if(u===void 0)return N(h);if(m)return u=setTimeout(k,n),x(h)}return u===void 0&&(u=setTimeout(k,n)),i}return I.cancel=T,I.flush=b,I}function Le(e){var n=typeof e;return!!e&&(n=="object"||n=="function")}function js(e){return!!e&&typeof e=="object"}function ks(e){return typeof e=="symbol"||js(e)&&bs.call(e)==cs}function We(e){if(typeof e=="number")return e;if(ks(e))return He;if(Le(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Le(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=e.replace(ls,"");var s=us.test(e);return s||fs.test(e)?hs(e.slice(2),s?2:8):ds.test(e)?He:+e}var Ns=vs;const _e=ht(Ns);function Ss(){const{id:e}=qe(),n=()=>{const S=_(),E=typeof e=="string"?Ce(S,e):null;return(E==null?void 0:E.title)||"Untitled Page"},[s,o]=f.useState(n()),[r,a]=f.useState(!1),[i,u]=f.useState([]),[h,c]=f.useState(!1),[l,m]=f.useState(!1),[v,x]=f.useState(!1),[N,d]=f.useState(!1),p=f.useRef(null),[k]=f.useState("acquired"),[A,T]=f.useState(null),[b,I]=f.useState(!1),w=K()||{};f.useEffect(()=>{const S=()=>c(!0),E=()=>m(!0),j=()=>d(!0);return window.addEventListener("open-history",S),window.addEventListener("open-search",E),window.addEventListener("open-user-profile",j),()=>{window.removeEventListener("open-history",S),window.removeEventListener("open-search",E),window.removeEventListener("open-user-profile",j)}},[]);const[D,B]=f.useState(!1);f.useEffect(()=>{let S=!1;I(!1),B(!1);async function E(){try{const j=await W(`docs/${e}.json`);let M=null;if(j&&j.json)M=j.json;else if(j&&j.content)try{M=JSON.parse(j.content)}catch{M=null}if(!M)throw new Error("No content");if(o(M.title||n()),T(se(M.content)),B(!1),I(!0),!S){const y=O();y.docs[e]=M,ee(y),R(y)}}catch{const M=O().docs[e];if(M){o(M.title||n()),T(se(M.content)),B(!1),I(!0);return}const y=_(),g=Ce(y,e);if(!g){B(!0),o("Page not found"),T(""),I(!0);return}const C=(g==null?void 0:g.initial)||{content:"<p>Start writing…</p>"};o((g==null?void 0:g.title)||n()),T(se(C.content)),B(!1),I(!0)}}return E(),()=>{S=!0}},[e]),f.useEffect(()=>{const S=()=>{const E=_(),j=st(E,e);u(j||[])};return S(),window.addEventListener("docs-index-updated",S),()=>window.removeEventListener("docs-index-updated",S)},[e]);const U=Qt({extensions:[Zt.configure({history:!0}),Gt,es,en.configure({openOnClick:!0,autolink:!0}),Jn,tn,nn,sn,Xn,rn,on,an],content:A||"",editable:k!=="failed",onUpdate:({editor:S})=>{const E=S.getHTML(),j=O(),M=!j.docs[e];let y=(w==null?void 0:w.username)||(w==null?void 0:w.email)||(w==null?void 0:w.name)||"Unknown";M&&(j.docs[e]={title:s,content:E,updatedAt:null,lastEditedBy:y}),j.docs[e].title=s,j.docs[e].content=E,j.docs[e].updatedAt=new Date().toISOString(),j.docs[e].lastEditedBy=y,ee(j),R(j),Mn(e),a(!0),oe()}},[e,A,s,w.name]),oe=_e(()=>a(!1),400);f.useEffect(()=>{const S=_e(E=>{const j=O();j.docs[e]&&(j.docs[e].title=E),ee(j),R(j);try{console.log("[EditorPage] updated doc title only",{id:e,title:E})}catch{}},500);return S(s),()=>S.cancel()},[s,e]),f.useEffect(()=>{const S=setInterval(()=>{const j=O().docs[e];j&&ts(e,{user:j.lastEditedBy,content:j.content,title:j.title})},6e4);return()=>clearInterval(S)},[e]);const ae=ns(e),[te,V]=f.useState({show:!1,type:"",message:""}),be=async()=>{a(!0);const E=O().docs[e];if(!E){a(!1);return}const j=await W(`docs/${e}.json`),M=j==null?void 0:j.sha,y=await q(`docs/${e}.json`,E,M);a(!1),y.ok?(V({show:!0,type:"success",message:"Saved the data"}),setTimeout(()=>V({show:!1,type:"",message:""}),2e3)):(V({show:!0,type:"error",message:"Save failed!"}),setTimeout(()=>V({show:!1,type:"",message:""}),2e3))},J=S=>{U==null||U.commands.setContent(S.content,!1),o(S.title||s);const E=O();E.docs[e]&&(E.docs[e].content=S.content,S.title&&(E.docs[e].title=S.title),ee(E),R(E)),c(!1)};return b?D?t.jsx("div",{className:"max-w-2xl mx-auto px-6 py-12 text-center text-lg text-red-600",children:t.jsx("strong",{children:"No document found."})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-[#101828] shadow-sm border-b border-borderLight dark:border-[#232b3b]",children:t.jsx(qn,{editor:U})}),t.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-white dark:bg-[#101828] rounded-2xl shadow-xl border border-borderLight dark:border-[#232b3b] p-8",children:[t.jsxs("nav",{className:"text-[15px] mb-4 text-gray-400 dark:text-gray-400 flex items-center flex-wrap gap-1",children:[t.jsx("span",{className:"text-atlassianBlue font-semibold cursor-pointer",children:"DocX"}),t.jsx("span",{className:"px-1",children:"/"}),i.length===0?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-atlassianBlue font-semibold cursor-pointer",children:"Pages"}),t.jsx("span",{className:"px-1",children:"/"}),t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-100",children:s||"Page"})]}):i.filter(S=>S.id!=="root").map((S,E,j)=>t.jsxs("span",{className:E===j.length-1?"font-semibold text-gray-700 dark:text-gray-100":"text-atlassianBlue font-semibold cursor-pointer hover:underline",children:[S.title||"Untitled",E<j.length-1&&t.jsx("span",{className:"px-1",children:"/"})]},S.id)),t.jsx("span",{className:"ml-3 inline-block text-[11px] px-2 py-0.5 border border-borderLight rounded-full bg-gray-100 dark:bg-[#232b3b] text-gray-500 dark:text-gray-300",children:"DRAFT"})]}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("input",{className:"flex-1 text-[2rem] font-bold placeholder:text-[#A5ADBA] bg-transparent outline-none dark:text-white rounded-lg px-2 py-1 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 transition",value:s,onChange:S=>o(S.target.value),placeholder:"Page title",style:{marginBottom:0}}),t.jsx("button",{onClick:be,className:"ml-2 px-5 py-2 text-base rounded-lg bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition",style:{whiteSpace:"nowrap"},children:"Save"})]}),t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-400",children:["Last edited by ",t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:yn()||(w==null?void 0:w.name)||(w==null?void 0:w.username)||(w==null?void 0:w.email)||"Unknown"}),t.jsx(Qn,{docId:e})]})}),t.jsxs("div",{className:"editor-surface p-4 rounded-xl bg-gray-50 dark:bg-[#181f2a] border border-gray-200 dark:border-[#232b3b]",children:[!U&&t.jsx(Je,{}),U&&t.jsx(cn,{editor:U,className:"prose max-w-none dark:prose-invert"})]})]})}),t.jsx(ss,{open:h,onClose:()=>c(!1),history:ae,onRestore:J}),t.jsx(os,{open:l,onClose:()=>m(!1)}),t.jsx(as,{open:N,onClose:()=>d(!1),anchorRef:p}),te.show&&t.jsx("div",{className:`fixed top-6 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded shadow-lg z-50 transition-all ${te.type==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:te.message})]}):t.jsx(Je,{})}function Ce(e,n){for(const s of e){if(s.type==="doc"&&s.id===n)return s;if(s.children){const o=Ce(s.children,n);if(o)return o}}return null}function Je(){return t.jsxs("div",{className:"space-y-4 animate-pulse","aria-label":"Loading editor",children:[t.jsx("div",{className:"h-5 w-2/5 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 w-full rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-11/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-5/6 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-2/3 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-3/4 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-1/2 rounded bg-gray-200 dark:bg-[#1F2937]"})]}),t.jsx("div",{className:"h-5 w-1/3 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 w-full rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-10/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-9/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-2/3 rounded bg-gray-200 dark:bg-[#1F2937]"})]})]})}function Es(){const{id:e}=qe(),[n,s]=f.useState(!1),[o,r]=f.useState({title:"Untitled",content:"<p>No content.</p>"});f.useEffect(()=>{let i=!0;const u=O();if(u.docs[e]){r(u.docs[e]);return}return s(!0),Hn().then(()=>{if(!i)return;const h=O().docs[e];h&&r(h),s(!1)}),()=>{i=!1}},[e]);const a=se(o.content);return t.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[t.jsxs("h1",{className:"text-3xl font-semibold mb-6",children:[o.title,n&&t.jsx("span",{className:"ml-2 text-xs text-textSecondary",children:"(loading…)"})]}),n?t.jsxs("div",{className:"animate-pulse space-y-3 bg-white dark:bg-[#0F172A] p-6 rounded border border-borderLight dark:border-[#1F2937]",children:[t.jsx("div",{className:"h-4 w-3/4 bg-gray-200 dark:bg-[#1F2937] rounded"}),t.jsx("div",{className:"h-4 w-2/3 bg-gray-200 dark:bg-[#1F2937] rounded"}),t.jsx("div",{className:"h-4 w-1/2 bg-gray-200 dark:bg-[#1F2937] rounded"})]}):t.jsx("article",{className:"prose max-w-none bg-white dark:bg-[#0F172A] p-6 rounded border border-borderLight dark:border-[#1F2937]",dangerouslySetInnerHTML:{__html:a}})]})}function he(){return!!K()}function Ls(){const e=he(),[n,s]=f.useState(!1);function o(a){for(const i of a){if(i.type==="doc")return i.id;if(i.children){const u=o(i.children);if(u)return u}}return null}let r="demo";if(e){const a=_();r=o(a)||"demo"}return t.jsxs("div",{className:"min-h-screen text-textPrimary dark:text-white",children:[t.jsx(Dn,{}),t.jsxs("div",{className:"flex flex-nowrap",children:[e&&t.jsx("div",{style:{width:n?48:256,minWidth:n?48:180,maxWidth:n?48:480},className:"h-[calc(100vh-56px)] bg-white dark:bg-[#101624] border-r border-gray-200 dark:border-gray-800 transition-all duration-150 ease-in-out",children:t.jsx(_n,{collapsed:n,setCollapsed:s})}),t.jsx("div",{className:"flex-1 min-h-[calc(100vh-56px)] bg-[#FAFBFC] dark:bg-[#0B0F1A] transition-all duration-150 ease-in-out",children:t.jsxs(Ke,{children:[t.jsx(G,{path:"/",element:e?t.jsx(ne,{to:`/view/${r}`,replace:!0}):t.jsx(ne,{to:"/login",replace:!0})}),t.jsx(G,{path:"/docs/:id",element:he()?t.jsx(Ss,{}):t.jsx(ne,{to:"/login"})}),t.jsx(G,{path:"/view/:id",element:he()?t.jsx(Es,{}):t.jsx(ne,{to:"/login"})}),t.jsx(G,{path:"/settings",element:he()?t.jsx(it,{}):t.jsx(ne,{to:"/login"})})]})})]})]})}function Cs(){const[e,n]=f.useState(""),[s,o]=f.useState(""),r=Ae(),a=async()=>{var N;const i=await vn()||[];console.debug("[Login] fetched users list",i);const u=String(e||"").trim(),h=String(s||"").trim(),c=Array.isArray(i)?i:i?Object.values(i):[],l=c.find(d=>{if(!d)return!1;const p=String(d.username||d.id||d.email||"").trim(),k=String(d.password||"").trim();return p===u&&k===h});if(!l)return console.debug("[Login] credentials did not match any remote user",{uname:u,usersArray:c}),alert("Invalid credentials");tt(l);try{X()||console.debug("[Login] remote token not present; attempting anonymous fetch");let d=await W("index.json");if(console.debug("[Login] fetched remote index.json",d),!d||!d.json){console.log("[Login] appdata.json not found, trying index.json");const p=await W("index.json");if(console.debug("[Login] fetched remote index.json",p),p!=null&&p.json){const k={index:p.json,docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:new Date().toISOString(),dirty:!1}};try{R(k)}catch(A){console.warn("[Login] saveAppdata(minimal) failed",A)}}else console.warn("[Login] neither appdata.json nor index.json found in remote repo")}else try{let p=null;if(d.json&&Array.isArray(d.json.index)?p=d.json.index:Array.isArray(d.json)?p=d.json:d.json&&Array.isArray((N=d.json.index)!=null&&N.children?d.json.index:null)&&(p=d.json.index),p===null)console.warn("[Login] remote returned unexpected shape; skipping saveAppdata");else{const k={index:p,docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:new Date().toISOString(),dirty:!1}};try{R(k),console.log("[Login] loaded minimal Appdata (index only) into memory")}catch(A){console.warn("[Login] saveAppdata(minimal) failed",A)}}}catch(p){console.warn("[Login] saveAppdata failed",p)}}catch(d){console.warn("[Login] fetch remote appdata failed",d)}let m=_();Array.isArray(m)||(console.warn("[Login] docs index is missing or malformed, falling back to default root"),m=[{id:"root",type:"folder",title:"Pages",children:[]}]);const v=d=>{for(const p of d){if(p.type==="doc")return p.id;if(p.children){const k=v(p.children);if(k)return k}}return null};let x=v(m);if(x)try{const d=await W(`docs/${x}.json`);if(d!=null&&d.json){const p=O();p.docs=p.docs||{};const k=d.json;p.docs[x]={title:k.title||p.docs[x]&&p.docs[x].title||"Untitled Page",content:k.content||p.docs[x]&&p.docs[x].content||"<p>Start writing\x0026hellip;</p>",updatedAt:k.updatedAt||p.docs[x]&&p.docs[x].updatedAt||null,lastEditedBy:k.lastEditedBy||p.docs[x]&&p.docs[x].lastEditedBy||"Unknown"},R(p)}}catch(d){console.warn("[Login] fetch remote doc failed",d)}else{const d=O();x=Ln(d,"root","Page title","<p>Start writing…</p>")}r(`/docs/${x}`)};return t.jsx("div",{className:"h-screen flex items-center justify-center bg-[#F4F5F7] dark:bg-[#0B0F1A]",children:t.jsxs("div",{className:"bg-white dark:bg-[#0F172A] rounded shadow-lg p-6 w-80 border border-borderLight dark:border-[#1F2937]",children:[t.jsx("h2",{className:"text-center text-lg font-semibold mb-4",children:"Login"}),t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-3 bg-white dark:bg-[#0B0F1A]",placeholder:"username",value:e,onChange:i=>n(i.target.value)}),t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-4 bg-white dark:bg-[#0B0F1A]",placeholder:"password",type:"password",value:s,onChange:i=>o(i.target.value)}),t.jsx("button",{onClick:a,className:"w-full bg-atlassianBlue text-white py-2 rounded hover:brightness-110",children:"Login"})]})})}function As(){const[e,n]=f.useState(!1);return f.useEffect(()=>{const s=o=>n(!!o.detail);return window.addEventListener("blocking-loader",s),()=>window.removeEventListener("blocking-loader",s)},[]),e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:t.jsxs("div",{className:"bg-white dark:bg-[#0B1220] p-6 rounded shadow flex items-center gap-3",children:[t.jsx(Ve,{className:"w-6 h-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-sm",children:"Syncing"})]})}):null}window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("open-search")))});const Fs=()=>t.jsxs(mt,{basename:"/DocX-Build/",children:[t.jsx(As,{}),t.jsxs(Ke,{children:[t.jsx(G,{path:"/login",element:t.jsx(Cs,{})}),t.jsx(G,{path:"/*",element:t.jsx(Ls,{})})]})]});Ne.createRoot(document.getElementById("root")).render(t.jsx(Xe.StrictMode,{children:t.jsx(Fs,{})}));

import{r as f,b as ut,u as ft,N as ht,c as Fe,R as Xe,d as de,g as mt,e as Ye,f as Qe,h as Z,i as se,B as pt}from"./react-BGFTG1xr.js";import{S as gt,M as xt,a as Ge,C as bt,U as yt,b as wt,c as Te,L as Ve,T as vt,d as jt,e as kt,f as Nt,F as De,g as Be,P as Ze,h as St,i as Et,j as Lt,B as At,I as Ct,k as Ft,l as Tt,m as Dt,n as Bt,o as It,p as Mt,Q as Pt,q as Ot,r as Ut,s as Rt,t as $t,u as Ht,v as zt,H as Wt,w as _t,R as Jt,X as Kt}from"./icons-Dm3c1Kyp.js";import{N as qt,m as Xt,a as Yt,T as Qt,E as Gt,u as Vt,S as Zt,U as en,L as tn,H as nn,b as sn,c as rn,d as an,e as on,f as cn,g as ln}from"./tiptap-Hx5odmou.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();var et={exports:{}},xe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dn=f,un=Symbol.for("react.element"),fn=Symbol.for("react.fragment"),hn=Object.prototype.hasOwnProperty,mn=dn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pn={key:!0,ref:!0,__self:!0,__source:!0};function tt(e,n,s){var a,r={},o=null,i=null;s!==void 0&&(o=""+s),n.key!==void 0&&(o=""+n.key),n.ref!==void 0&&(i=n.ref);for(a in n)hn.call(n,a)&&!pn.hasOwnProperty(a)&&(r[a]=n[a]);if(e&&e.defaultProps)for(a in n=e.defaultProps,n)r[a]===void 0&&(r[a]=n[a]);return{$$typeof:un,type:e,key:o,ref:i,props:r,_owner:mn.current}}xe.Fragment=fn;xe.jsx=tt;xe.jsxs=tt;et.exports=xe;var t=et.exports,Se={},Ie=ut;Se.createRoot=Ie.createRoot,Se.hydrateRoot=Ie.hydrateRoot;async function Me(){try{let e=null;if(typeof ee=="function"&&(e=await ee()),!e&&typeof ee=="function"&&(e=ee()),e){const n=e.length>8?e.slice(0,4)+"..."+e.slice(-4):e;console.warn("[DEBUG] Extracted GitHub PAT:",n)}else console.warn("[DEBUG] No GitHub PAT extracted.")}catch(e){console.error("[DEBUG] Error extracting PAT:",e)}}const Pe="https://api.github.com",Oe="Dizitalize",Ue="DocX",Re="main";let ue=null;async function ee(){if(ue!==null)return ue;try{const e={algorithm:"AES-256-GCM",iterations:2e5,salt:"Ei/WnQMaMqawearYfMcuKg==",iv:"Sh2Pz5alGa+/9k3n",tag:"HTsPbQ2BeBB6drDc03nJiA==",data:"nNWfHmK5k5Fr2h6n2ZxIUBcka1OJn1/VcFL2/6vs1r+94PinC3piQKEstKAMk4zv1ysgQTuq1QEepwUB6jjqZ5v/6zWLfJgMJ0PNHPZQa8qmlwoPGlqqjLxi8sN+"},n="Docxv11",s=Uint8Array.from(atob(e.salt),c=>c.charCodeAt(0)),a=Uint8Array.from(atob(e.iv),c=>c.charCodeAt(0)),r=Uint8Array.from(atob(e.tag),c=>c.charCodeAt(0)),o=Uint8Array.from(atob(e.data),c=>c.charCodeAt(0)),i=await window.crypto.subtle.importKey("raw",new TextEncoder().encode(n),{name:"PBKDF2"},!1,["deriveKey"]),d=await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:e.iterations,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!1,["decrypt"]),h=new Uint8Array([...o,...r]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:128},d,h);return ue=new TextDecoder().decode(l),ue}catch(e){return console.error("[getToken] Decryption failed:",e),null}}async function $e(){if(typeof Me=="function")try{Me()}catch{}const e=await ee(),n={Accept:"application/vnd.github.v3+json"};return e&&(n.Authorization=`token ${e}`),n}function gn(e){try{const n=typeof e=="string"?e:JSON.stringify(e);if(typeof globalThis.btoa=="function")return globalThis.btoa(unescape(encodeURIComponent(n)))}catch{}return""}async function xn(e,n,s=3){let a=0;for(;;)try{return await e()}catch(r){if(a++,a>=s)throw r;await new Promise(o=>setTimeout(o,150*a))}}class ${static dispatchSyncState(n){try{window.dispatchEvent(new CustomEvent("sync-state",{detail:n}))}catch{}}static dispatchBlocking(n){try{window.dispatchEvent(new CustomEvent("blocking-loader",{detail:n}))}catch{}}static async getFile(n){$.dispatchSyncState("flushing"),$.dispatchBlocking(!0);try{return await xn(async()=>{const s=await fetch(`${Pe}/repos/${Oe}/${Ue}/contents/${n}?ref=${Re}`,{headers:await $e(),cache:"no-cache"});if(!s.ok)return null;const a=await s.json(),r=a.sha,o=a.content,i=o?atob(o):null;try{return{json:i?JSON.parse(i):null,sha:r}}catch{return{json:i,sha:r}}})}finally{$.dispatchSyncState("idle"),$.dispatchBlocking(!1)}}static async putFile(n,s,a){var r;$.dispatchSyncState("flushing"),$.dispatchBlocking(!0),console.log("pushing json file to github:",n,s,a);try{if(s==null||typeof s=="string"&&s.trim()==="")return{ok:!1,reason:"Attempted to save empty/undefined/null content"};let o=s;if(typeof s=="object"&&(o=JSON.stringify(s)),!o||typeof o=="string"&&o.trim()==="")return{ok:!1,reason:"Attempted to save empty content after stringify"};const i=gn(o);if(!i||i.trim()==="")return{ok:!1,reason:"Attempted to save empty content after encodeContent"};const d={message:`Update ${n}`,content:i,branch:Re};a&&(d.sha=a);const h=await fetch(`${Pe}/repos/${Oe}/${Ue}/contents/${n}`,{method:"PUT",headers:{...await $e(),"Content-Type":"application/json"},body:JSON.stringify(d)});return h.ok?{ok:!0,sha:(r=(await h.json()).content)==null?void 0:r.sha}:{ok:!1,reason:await h.text()}}catch(o){return{ok:!1,reason:String(o)}}finally{$.dispatchSyncState("idle"),$.dispatchBlocking(!1)}}}const W=$.getFile,q=$.putFile;function K(){return!!ee()}function bn(e,n="docxkey"){try{return atob(e).split("").map((s,a)=>String.fromCharCode(s.charCodeAt(0)^n.charCodeAt(a%n.length))).join("")}catch{return""}}const yn="displayNameEnc";function wn(){const e=localStorage.getItem(yn);return e?bn(e):""}let z=null,be=null;const ae="currentUserSession",Ee="lastInteraction";try{const e=localStorage.getItem(ae);if(e){const n=JSON.parse(e);n&&n.user&&n.expiresAt&&Number(n.expiresAt)>Date.now()?be=n.user:localStorage.removeItem(ae)}}catch{}function vn(){return z||[]}async function jn(){try{const e=await W("users.json");if(!e)return z=[];let n=null;if(e&&typeof e=="object"&&"json"in e)n=e.json;else try{n=JSON.parse(typeof e=="string"?e:String(e))}catch{n=null}if(Array.isArray(n)){z=n;try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}return z}if(n&&typeof n=="object"){try{z=Object.values(n)}catch{z=[]}try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}return z}return z=[]}catch(e){return console.warn("[users] fetchRemoteUsers failed",e),z=[]}}function kn(e){z=e;try{window.dispatchEvent(new CustomEvent("users-updated"))}catch{}}function Nn(e,n){const s=vn(),a=s.findIndex(r=>r.username===e);return a===-1?!1:(s[a]={...s[a],...n},kn(s),!0)}function X(){return be}function nt(e,n=1e3*60*60*3){be=e;try{window.dispatchEvent(new CustomEvent("current-user-updated"))}catch{}try{if(e){const s=Date.now()+Number(n||0);localStorage.setItem(ae,JSON.stringify({user:e,expiresAt:s})),localStorage.setItem(Ee,String(Date.now()))}else localStorage.removeItem(ae),localStorage.removeItem(Ee)}catch{}}function Sn(){be=null;try{window.dispatchEvent(new CustomEvent("current-user-updated"))}catch{}try{localStorage.removeItem(ae),localStorage.removeItem(Ee)}catch{}}const En=!0;function Ln(){return En}let pe=null;function M(){if(pe)return pe;const e={index:[{id:"root",type:"folder",title:"Pages",children:[]}],docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:null,dirty:!1}};return pe=e,e}function O(e){pe=e;{try{console.log("[Appdata] updated (remote-only cache)",e)}catch{}try{window.dispatchEvent(new CustomEvent("appdata-updated",{detail:e}))}catch{}return}}function te(e){e.syncMeta=e.syncMeta||{lastSync:null,dirty:!1},e.syncMeta.dirty=!0}function An(e,n,s="Untitled Page",a="<p>Start writing\x0026hellip;</p>"){const r="doc-"+Date.now();e.docs[r]={title:s,content:a,updatedAt:new Date().toISOString(),lastEditedBy:"System",modifiedBy:"System"},e.comments[r]={},e.history[r]=[];const o=st(e.index,n)||e.index[0];o.children=o.children||[],o.children.push({id:r,type:"doc",title:s,initial:null}),te(e),O(e);try{console.log("[Appdata:createDoc] Created doc",{id:r,title:s,parent:n,contentPreview:a.slice(0,40)})}catch{}return r}function st(e,n){for(const s of e){if(s.id===n)return s;if(s.children){const a=st(s.children,n);if(a)return a}}return null}function re(e){if(!e)return"<p>No content.</p>";const n=String(e).trim(),s=/^[a-zA-Z]:(\\|\/).+\.(png|jpg|jpeg|gif|bmp|webp)$/i,a=/ScreenClip[\\/].+\.(png|jpg|jpeg|gif|bmp|webp)$/i;return s.test(n)||a.test(n)||n.startsWith("file:///")?"<p>[Image or local file detected — content not embedded]</p>":!n.includes("<")&&n.length<260&&/\.(png|jpg|jpeg|gif|bmp|webp)$/i.test(n)?"<p>[Image reference removed]</p>":n}function He(){try{const e=X()||{};return e.id||e.email||e.name||"anonymous"}catch{return"anonymous"}}function Cn(e){return(e||"folder").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"folder"}function Fn(e){const n=[];function s(a,r){for(const o of a)if(o.type==="folder"){const i=Cn(o.title),d=[...r,i],h="root"+(d.length?"/"+d.join("/"):""),l=(o.children||[]).filter(c=>c.type==="doc").map(c=>({id:c.id,title:c.title,createdAt:new Date().toISOString(),modifiedAt:new Date().toISOString(),createdBy:He()}));n.push({id:o.id,type:"folder",path:h,title:o.title,createdAt:new Date().toISOString(),modifiedAt:new Date().toISOString(),createdBy:He(),pages:l}),s((o.children||[]).filter(c=>c.type==="folder"),d)}}return s(e,[]),n}async function G(e){try{const n=Fn(e);Ln();try{window.dispatchEvent(new CustomEvent("root-updated",{detail:n}))}catch{}}catch(n){console.warn("[remoteFolders] updateRootTree local failed",n)}}function Tn(){const[e,n]=f.useState(!1);return f.useEffect(()=>{const s=document.documentElement;e?s.classList.add("dark"):s.classList.remove("dark")},[e]),t.jsxs("button",{className:"flex items-center gap-2 px-2 py-1 rounded border border-borderLight dark:border-[#1F2937] hover:bg-[#F4F5F7] dark:hover:bg-[#101828] transition",onClick:()=>n(s=>!s),title:"Toggle theme",children:[e?t.jsx(gt,{className:"w-4 h-4"}):t.jsx(xt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:e?"Light":"Dark"})]})}function Dn(){const[e,n]=f.useState("idle"),[s,a]=f.useState(!1),[r,o]=f.useState(null);f.useEffect(()=>{const h=c=>n(c.detail);window.addEventListener("sync-state",h);const l=setInterval(()=>{try{const c=window.__remoteSyncStatus;c&&(a(c.hasDirty),c.lastError&&o(c.lastError))}catch{}},4e3);return()=>{window.removeEventListener("sync-state",h),clearInterval(l)}},[]);let i=null,d="";return e==="bootstrap"?(i=t.jsx(wt,{className:"w-4 h-4 animate-pulse"}),d="Bootstrapping remote data"):e==="scheduled"?(i=t.jsx(Te,{className:"w-4 h-4 animate-pulse"}),d="Changes queued for sync"):e==="flushing"?(i=t.jsx(Ve,{className:"w-4 h-4 animate-spin"}),d="Syncing with GitHub..."):r?(i=t.jsx(vt,{className:"w-4 h-4 text-amber-500"}),d="Sync warning: check console"):s?(i=t.jsx(Te,{className:"w-4 h-4"}),d="Pending local changes"):(i=t.jsx(jt,{className:"w-4 h-4 text-emerald-500"}),d="All changes saved"),t.jsx("div",{className:"flex items-center gap-1 text-xs text-textSecondary dark:text-gray-400",title:d,children:i})}function Bn(){const e=f.useRef(null);return t.jsxs("header",{className:"h-14 bg-white dark:bg-[#0B0F1A] border-b border-borderLight dark:border-[#1F2937] flex items-center justify-between px-4",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("img",{src:"https://github.com/dizitalize/DocX/raw/main/logo.png",alt:"DocX Logo",className:"w-16 h-16",style:{objectFit:"contain"}})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Dn,{}),t.jsx(Tn,{}),t.jsx(Ge,{className:"w-5 h-5 cursor-pointer text-textSecondary dark:text-gray-300",onClick:()=>window.dispatchEvent(new CustomEvent("open-search"))}),t.jsx(bt,{className:"w-5 h-5 cursor-pointer text-textSecondary dark:text-gray-300"}),t.jsx("div",{ref:e,className:"w-8 h-8 rounded-full bg-[#DFE1E6] dark:bg-[#1F2937] flex items-center justify-center cursor-pointer",onClick:()=>window.dispatchEvent(new CustomEvent("open-user-profile")),children:t.jsx(yt,{className:"w-5 h-5 text-textSecondary dark:text-gray-300"})})]})]})}function rt(e,n,s=[]){for(const a of e){const r=[...s,a];if(a.id===n)return r;if(a.children){const o=rt(a.children,n,r);if(o)return o}}return null}function _(){const e=M().index;return Array.isArray(e)?e:[{id:"root",type:"folder",title:"Pages",children:[]}]}function fe(e){const n=M();n.index=e,O(n);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}}function Y(e,n){for(const s of e){if(s.id===n)return s;if(s.children){const a=Y(s.children,n);if(a)return a}}return null}function Le(e,n){for(let s=0;s<e.length;s++){const a=e[s];if(a.id===n)return e.splice(s,1),a;if(a.children){const r=Le(a.children,n);if(r)return r}}return null}function In(e,n,s){const a=Y(e,n);return a?(a.active=s,!0):!1}function ve(e,n,s,a=-1){const r=Y(e,n);return!r||r.type!=="folder"?!1:(r.children=r.children||[],a>=0?r.children.splice(a,0,s):r.children.push(s),!0)}function Mn(e,n,s){const a=Y(e,n);return a?(a.title=s,!0):!1}const ge=[],he={};let je=!1;const Pn=7e3;function at(e){he[e.resource]&&clearTimeout(he[e.resource]),he[e.resource]=setTimeout(()=>{ge.find(n=>n.resource===e.resource)||ge.push(e),Rn(),delete he[e.resource]},Pn)}function V(){at({resource:"index",type:"index"})}function On(e){at({resource:`doc:${e}`,type:"doc",id:e})}async function Un(e){try{e.type==="doc"&&e.id?await zn(e.id):e.type==="index"&&await Hn()}catch(n){console.warn("[remoteSync] processTask failed",e,n)}}async function Rn(){if(!je){for(je=!0;ge.length;){const e=ge.shift();await Un(e)}je=!1}}function $n(e,n,s){const a=new Map,r=i=>a.set(i.id,{...i});(s||[]).forEach(i=>r(i)),(e||[]).forEach(i=>{a.has(i.id)||r(i)}),(n||[]).forEach(i=>r(i));const o=new Set((n||[]).map(i=>i.id).concat((s||[]).map(i=>i.id)));return Array.from(o).map(i=>a.get(i))}async function Hn(){const e=M(),n=e.index||[];if(!n||n.length===0){console.error("[remoteSync] syncIndex: local index is empty, aborting putFile. This should never happen!");return}try{const s=await W("index.json");console.debug("[remoteSync] syncIndex: isRemoteEnabled=",K());const a=s?typeof s=="object"&&"json"in s?s.json:typeof s=="string"?JSON.parse(s):s:null,r=s&&typeof s=="object"&&"sha"in s?s.sha:void 0;if(!a){if(!K()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:"index",reason:"remote-writes-disabled"}}))}catch{}e.index=n,O(e);return}console.debug("[remoteSync] creating remote index.json");const l=await q("index.json",n);console.debug("[remoteSync] putFile create result",l);return}const o=Array.isArray(a)?a:a&&Array.isArray(a.index)?a.index:[],i=Array.isArray(n)?n:[];if(JSON.stringify(o)===JSON.stringify(i))return;const d=$n(o,i,o);if(console.log("[remoteSync] merged index to be saved:",d),!K()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:"index",reason:"remote-writes-disabled",merged:d}}))}catch{}e.index=d,O(e);return}console.debug("[remoteSync] updating remote index.json");const h=await q("index.json",d,r);console.debug("[remoteSync] putFile update result",h),e.index=d,O(e)}catch(s){console.warn("[remoteSync] syncIndex failed",s)}}async function zn(e){const n=M(),s=(n.docs||{})[e];if(s)try{const a=await W(`docs/${e}.json`),r=a?typeof a=="object"&&"json"in a?a.json:typeof a=="string"?JSON.parse(a):a:null,o=a&&typeof a=="object"&&"sha"in a?a.sha:void 0;if(!r){if(!K()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:`doc:${e}`,reason:"remote-writes-disabled"}}))}catch{}n.docs[e]=s,O(n);return}const c=await q(`docs/${e}.json`,s);console.debug("[remoteSync] putFile create doc result",c);return}if(JSON.stringify(r)===JSON.stringify(s))return;const i=new Date(s.updatedAt||0).getTime(),d=new Date(r.updatedAt||0).getTime(),h=i>=d?s:r;if(!K()){try{window.dispatchEvent(new CustomEvent("sync-skipped",{detail:{resource:`doc:${e}`,reason:"remote-writes-disabled",chosen:h}}))}catch{}n.docs[e]=h,O(n);return}const l=await q(`docs/${e}.json`,h,o);console.debug("[remoteSync] putFile update doc result",l),n.docs[e]=h,O(n)}catch(a){console.warn("[remoteSync] syncDoc failed",e,a)}}async function Wn(e){return!1}function ot({node:e,depth:n=0,onDragStart:s,onDrop:a,onDragOver:r,onDelete:o,onCreateDoc:i,onCreateFolder:d,onRename:h,autoEditId:l}){var T;const[c,m]=f.useState(!0),[v,x]=f.useState(l===e.id),[N,u]=f.useState(e.title),p=f.useRef(null),k=ft();f.useEffect(()=>{x(l===e.id),u(e.title)},[l,e.id,e.title,k.pathname]),f.useEffect(()=>{l&&Y([e],l)&&m(!0)},[l,e]),f.useEffect(()=>{v&&p.current&&(p.current.focus(),p.current.select())},[v]);const C=8+n*12;return e.type==="folder"?t.jsxs("div",{className:"select-none",children:[t.jsxs("div",{className:"group flex items-center gap-2 px-3 py-1.5 text-[15px] text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-[#181f2a] cursor-pointer rounded-lg transition-all shadow-sm",style:{paddingLeft:C,minHeight:36,fontWeight:500,letterSpacing:.1},draggable:!0,onDragStart:b=>s(b,e),onDragOver:b=>r(b,e),onDrop:b=>a(b,e),onClick:()=>m(b=>!b),children:[t.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-md bg-gray-200 dark:bg-[#232b3b] mr-1",children:c?t.jsx(kt,{className:"w-3.5 h-3.5"}):t.jsx(Nt,{className:"w-3.5 h-3.5"})}),t.jsx(De,{className:"w-4 h-4 text-blue-500 dark:text-blue-400"}),t.jsx("div",{className:"flex-1 min-w-0 flex items-center gap-1",children:v?t.jsx("input",{ref:p,value:N,onChange:b=>u(b.target.value),onBlur:()=>{N.trim()&&N!==e.title&&(h==null||h(e.id,N.trim())),x(!1),u(e.title)},onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.currentTarget.blur()),b.key==="Escape"&&(x(!1),u(e.title))},className:"w-full bg-transparent outline-none text-gray-800 dark:text-gray-100 text-[15px] px-1 rounded border border-gray-200 dark:border-[#232b3b] focus:border-blue-400 dark:focus:border-blue-500",style:{minWidth:0}}):t.jsx("span",{onDoubleClick:()=>x(!0),className:"truncate font-medium",style:{minWidth:0},children:e.title})}),e.id!=="root"&&t.jsx("button",{title:"Delete",onClick:b=>{b.stopPropagation(),o==null||o(e.id)},className:"opacity-0 group-hover:opacity-100 transition p-1 rounded hover:bg-red-50 dark:hover:bg-[#2a1a1a] ml-1",children:t.jsx(Be,{className:"w-4 h-4 text-red-400"})}),t.jsxs("div",{className:"flex gap-1 ml-1 opacity-0 group-hover:opacity-100 transition",children:[t.jsx("button",{title:"New page",onClick:b=>{b.stopPropagation(),i==null||i(e.id)},className:"p-1 rounded hover:bg-blue-50 dark:hover:bg-[#1a2233]",children:t.jsx(Ze,{className:"w-4 h-4 text-blue-500"})}),t.jsx("button",{title:"New folder",onClick:b=>{b.stopPropagation(),d==null||d(e.id)},className:"p-1 rounded hover:bg-blue-50 dark:hover:bg-[#1a2233]",children:t.jsx(De,{className:"w-4 h-4 text-blue-400"})}),t.jsx("button",{title:"Rename",onClick:b=>{b.stopPropagation(),x(!0)},className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-[#232b3b]",children:t.jsx(St,{className:"w-4 h-4 text-gray-400"})})]})]}),c&&((T=e.children)==null?void 0:T.filter(b=>b.active!==!1).map(b=>t.jsx(ot,{node:b,depth:n+1,onDragStart:s,onDragOver:r,onDrop:a,onDelete:o,onCreateDoc:i,onCreateFolder:d,onRename:h,autoEditId:l},b.id)))]}):t.jsxs(ht,{to:`/docs/${e.id}`,draggable:!0,onDragStart:b=>s(b,e),onDragOver:b=>r(b,e),onDrop:b=>a(b,e),className:({isActive:b})=>`group flex items-center gap-2 px-3 py-1.5 rounded-lg text-[15px] hover:bg-gray-100 dark:hover:bg-[#181f2a] transition shadow-sm ${b?"bg-white dark:bg-[#232b3b] shadow":"text-gray-700 dark:text-gray-200"}`,style:{paddingLeft:C,minHeight:36,fontWeight:500,letterSpacing:.1},children:[t.jsx(Et,{className:"w-4 h-4 text-green-500 dark:text-green-400"}),t.jsx("div",{className:"flex-1 min-w-0 flex items-center gap-1",children:v?t.jsx("input",{ref:p,value:N,onChange:b=>u(b.target.value),onBlur:()=>{x(!1),N.trim()&&N!==e.title&&(h==null||h(e.id,N.trim()))},onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),b.currentTarget.blur()),b.key==="Escape"&&(x(!1),u(e.title))},className:"w-full bg-transparent outline-none text-gray-800 dark:text-gray-100 text-[15px] px-1 rounded border border-gray-200 dark:border-[#232b3b] focus:border-green-400 dark:focus:border-green-500",style:{minWidth:0}}):t.jsx("span",{onDoubleClick:()=>x(!0),className:"truncate font-medium",style:{minWidth:0},children:e.title})}),t.jsx("button",{title:"Delete",onClick:b=>{b.preventDefault(),o==null||o(e.id)},className:"opacity-0 group-hover:opacity-100 transition p-1 rounded hover:bg-red-50 dark:hover:bg-[#2a1a1a] ml-1",children:t.jsx(Be,{className:"w-4 h-4 text-red-400"})})]})}function _n({open:e,onClose:n,target:s,docs:a,onConfirm:r}){if(!e)return null;const o=(s==null?void 0:s.type)==="folder";return t.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-32 bg-black/30 backdrop-blur-sm",children:t.jsxs("div",{className:"w-[520px] bg-white dark:bg-[#0F172A] rounded shadow-lg border border-borderLight dark:border-[#1F2937]",children:[t.jsx("div",{className:"px-5 py-4 border-b border-borderLight dark:border-[#1F2937] flex items-center justify-between",children:t.jsxs("h2",{className:"text-lg font-semibold",children:["Delete ",o?"Folder":"Page"]})}),t.jsxs("div",{className:"px-5 pt-4 pb-5 text-sm max-h-[360px] overflow-y-auto",children:[o?t.jsx("p",{className:"mb-3 text-textSecondary dark:text-gray-400",children:"You're about to delete this folder and all pages inside it. The following pages will be permanently removed:"}):t.jsx("p",{className:"mb-3 text-textSecondary dark:text-gray-400",children:"You're about to delete this page permanently:"}),t.jsxs("table",{className:"w-full text-left text-xs border border-borderLight dark:border-[#1F2937] rounded overflow-hidden",children:[t.jsx("thead",{className:"bg-[#F4F5F7] dark:bg-[#101828] text-textSecondary dark:text-gray-300",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-2 font-medium",children:"Title"}),t.jsx("th",{className:"py-2 px-2 font-medium w-32",children:"Last Edited By"}),t.jsx("th",{className:"py-2 px-2 font-medium w-40",children:"Updated"})]})}),t.jsx("tbody",{children:a.map(i=>{var v;const d=M(),h=((v=d==null?void 0:d.docs)==null?void 0:v[i.id])||null,l=(h==null?void 0:h.title)||i.title||"Untitled";let c=(h==null?void 0:h.lastEditedBy)||i.lastEditedBy||null,m="-";if(c&&(d!=null&&d.users)&&typeof d.users=="object"){const x=d.users[c];x?m=x.name||x.username||x.email||c:m=c}else c&&(m=c);return t.jsxs("tr",{className:"border-t border-borderLight dark:border-[#1F2937]",children:[t.jsx("td",{className:"py-1.5 px-2 text-[13px] truncate",children:l}),t.jsx("td",{className:"py-1.5 px-2 text-[13px]",children:m}),t.jsx("td",{className:"py-1.5 px-2 text-[11px] text-textSecondary dark:text-gray-400",children:h!=null&&h.updatedAt?new Date(h.updatedAt).toLocaleString():"-"})]},i.id)})})]})]}),t.jsxs("div",{className:"px-5 py-3 bg-[#F4F5F7] dark:bg-[#101828] border-t border-borderLight dark:border-[#1F2937] flex justify-end gap-2",children:[t.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A] hover:bg-[#EBECF0] dark:hover:bg-[#162032] transition",children:"Cancel"}),t.jsx("button",{onClick:r,className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:brightness-110 transition",children:"Delete"})]})]})})}function ke(e){try{localStorage.setItem("sidebarTree",JSON.stringify(e))}catch{}}function ze(){try{const e=localStorage.getItem("sidebarTree");return e?JSON.parse(e):null}catch{return null}}function We(e,n){let s;do s=e+"-"+Date.now()+"-"+Math.floor(Math.random()*1e6);while(Y(n,s));return s}function Jn({collapsed:e,setCollapsed:n}){var P;const s=(y,g)=>{r(A=>{const L=structuredClone(A);if(!Mn(L,y,g))return A;fe(L),G(L);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}return L})},[a,r]=f.useState(()=>{const y=ze();if(y&&Array.isArray(y)&&y.length>0&&!(y.length===1&&y[0].id==="root"&&(!y[0].children||y[0].children.length===0)))return y;const g=_();return g&&Array.isArray(g)&&g.length>0&&!(g.length===1&&g[0].id==="root"&&(!g[0].children||g[0].children.length===0))?g:[{id:"root",type:"folder",title:"Pages",children:[]}]}),[o,i]=f.useState(()=>ze()||_()),[d,h]=f.useState(!1),l=Fe(),c=((P=a[0])==null?void 0:P.id)||"root",m=y=>{r([...y]),fe(y)},[v,x]=f.useState(null),[N,u]=f.useState(!1),[p,k]=f.useState(null),[C,T]=f.useState(null),[b,B]=f.useState(256),w=180,D=480,I=f.useRef(null),R=f.useRef(!1);f.useEffect(()=>{function y(A){var U;if(!R.current)return;let L=A.clientX-(((U=I.current)==null?void 0:U.getBoundingClientRect().left)||0);L<w&&(L=w),L>D&&(L=D),B(L)}function g(){R.current=!1}return window.addEventListener("mousemove",y),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",g)}},[]),f.useEffect(()=>{const y=()=>{const g=_();r(g),ke(g),i(g),h(!1)};return window.addEventListener("docs-index-updated",y),K()&&W("index.json").then(g=>{g&&g.json&&(r(g.json),ke(g.json),i(g.json),h(!1)),g!=null&&g.sha&&T(g.sha)}).catch(()=>{}),()=>window.removeEventListener("docs-index-updated",y)},[]),f.useEffect(()=>{ke(a),h(JSON.stringify(a)!==JSON.stringify(o))},[a,o]),f.useEffect(()=>{const y=setInterval(async()=>{const g=a.length===1&&a[0].id==="root"&&(!a[0].children||a[0].children.length===0);if(JSON.stringify(a)!==JSON.stringify(o)&&!g){if(a.length===1&&a[0].id==="root"&&(!a[0].children||a[0].children.length===0))return;try{await q("index.json",a),i(a),h(!1)}catch{}}},1e4);return()=>clearInterval(y)},[a,o]);const oe=(y=c)=>{r(g=>{const A=M(),L=We("doc",g),U={id:L,type:"doc",title:"Untitled Page",initial:{content:"<p>Start writing…</p>"}};A.docs[L]={title:U.title,content:U.initial.content,updatedAt:new Date().toISOString(),lastEditedBy:"Unknown"},A.history[L]=[],A.comments[L]=[];const H=structuredClone(g);return ve(H,y,U),fe(H),G(H),k(L),q(`docs/${L}.json`,A.docs[L]),l(`/docs/${L}`),H})},ie=(y=c)=>{r(g=>{const A=We("folder",g),L={id:A,type:"folder",title:"Untitled Folder",active:!0,children:[]},U=structuredClone(g);ve(U,y,L),fe(U),G(U),k(A);try{window.dispatchEvent(new CustomEvent("docs-index-updated"))}catch{}return U})},ne=y=>{const g=[],A=L=>{L.type==="doc"&&g.push(L),L.children&&L.children.forEach(A)};return A(y),g},Q=y=>{const g=Y(a,y);!g||g.id===c||(x(g),u(!0))},ye=()=>{if(!v)return;const y=structuredClone(a);if(In(y,v.id,!1)){Le(y,v.id);const A=M();m(y),O(A),G(y),p===v.id&&k(null)}u(!1),x(null)};let J=null;const S=(y,g)=>{J=g,y.dataTransfer.effectAllowed="move"},E=y=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},j=(y,g)=>{if(y.preventDefault(),!J||J.id===g.id||J.active===!1)return;const A=structuredClone(a),L=Le(A,J.id);if(L){if(g.type==="folder")ve(A,g.id,L);else{const U=[{parent:null,list:A}];for(;U.length;){const{parent:H,list:we}=U.pop();for(let ce=0;ce<we.length;ce++){const le=we[ce];if(le.id===g.id){if(H){const lt=H.children.findIndex(dt=>dt.id===g.id);H.children.splice(lt+1,0,L)}else we.splice(ce+1,0,L);m(A),G(A),V();return}le.children&&U.push({parent:le,list:le.children})}}}m(A),G(A),V()}};return t.jsx(t.Fragment,{children:t.jsxs("aside",{ref:I,className:`bg-sidebarBg dark:bg-[#0B1220] border-r border-borderLight dark:border-[#1F2937] min-h-[calc(100vh-56px)] transition-all duration-150 ease-in-out relative ${e?"w-12":""}`,style:{width:e?48:b,minWidth:e?48:180,maxWidth:e?48:480},onMouseLeave:V,children:[t.jsxs("button",{className:"absolute top-3 -right-3 z-30 w-7 h-7 flex items-center justify-center bg-white dark:bg-[#101828] border border-borderLight dark:border-[#1F2937] rounded-full shadow-lg hover:bg-gray-100 dark:hover:bg-[#22223b] transition focus:outline-none",style:{boxShadow:"0 2px 8px #0002",borderWidth:"2px"},onClick:()=>n&&n(y=>!y),tabIndex:-1,children:[t.jsx("span",{className:"sr-only",children:e?"Expand sidebar":"Collapse sidebar"}),t.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 16 16",children:t.jsx("path",{d:e?"M6 4l4 4-4 4":"M10 4L6 8l4 4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),!e&&t.jsx("div",{className:"absolute top-0 right-0 h-full w-2 cursor-col-resize z-10",style:{userSelect:"none"},onMouseDown:()=>{R.current=!0}}),t.jsxs("div",{className:`flex flex-col h-full ${e?"items-center":""}`,children:[t.jsx("div",{className:`px-3 py-2 text-xs font-semibold text-textSecondary dark:text-gray-400 uppercase tracking-wide ${e?"hidden":""}`,children:"Pages"}),t.jsxs("div",{className:`px-3 pb-2 flex gap-2 ${e?"hidden":""}`,children:[t.jsxs("button",{onClick:oe,className:"flex-1 flex items-center gap-2 bg-white dark:bg-[#0F172A] border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 text-sm hover:shadow transition",children:[t.jsx(Ze,{className:"w-4 h-4"})," New page"]}),t.jsx("button",{onClick:()=>{ie(),V()},className:"px-3 py-2 bg-white dark:bg-[#0F172A] border border-borderLight dark:border-[#1F2937] rounded text-sm hover:shadow transition",title:"New folder",children:t.jsx(Lt,{className:"w-4 h-4"})})]}),t.jsx("div",{className:`px-3 py-2 text-xs font-semibold text-textSecondary dark:text-gray-400 uppercase tracking-wide ${e?"hidden":""}`,children:"Page tree"}),t.jsx("nav",{className:`px-1 overflow-y-auto max-h-[calc(100vh-56px-110px)] pb-4 flex-1 ${e?"hidden":""}`,children:a.filter(y=>y.active!==!1).map(y=>t.jsx(ot,{node:y,onDragStart:S,onDragOver:E,onDrop:j,onDelete:Q,onCreateDoc:oe,onCreateFolder:ie,onRename:(g,A)=>{s(g,A),V()},autoEditId:p},y.id))}),t.jsx(_n,{open:N,onClose:()=>{u(!1),x(null)},target:v,docs:v?ne(v):[],onConfirm:()=>{ye(),V()}})]})]})})}const Kn=qt.create({name:"image",group:"inline",inline:!0,draggable:!0,selectable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:"auto"},height:{default:"auto"},style:{default:null}}},parseHTML(){return[{tag:"img[src]"}]},renderHTML({HTMLAttributes:e}){return["img",Xt(e)]},addNodeView(){return({node:e,getPos:n,editor:s,selected:a})=>{const r=document.createElement("img");r.src=e.attrs.src,r.alt=e.attrs.alt||"",r.title=e.attrs.title||"",r.style.width=e.attrs.width||"auto",r.style.height=e.attrs.height||"auto",r.style.maxWidth="100%",r.style.cursor="pointer",r.draggable=!1,r.tabIndex=0;const o=document.createElement("span");o.style.position="relative",o.style.display="inline-block",o.style.verticalAlign="middle";function i(l){l.stopPropagation();const{state:c,view:m}=s,v=n();typeof v=="number"&&setTimeout(()=>{const x=c.tr.setSelection(Yt.create(c.doc,v));m.dispatch(x)},0)}r.addEventListener("click",i),r.addEventListener("contextmenu",l=>{i(l),l.preventDefault()}),o.addEventListener("click",l=>{i(l)});function d(l){r.style.outline=l?"2px solid #3182ce":"none",r.style.outlineOffset=l?"2px":"0";for(const c of o.querySelectorAll(".resize-handle"))c.style.display=l?"block":"none"}return[{x:0,y:0,cursor:"nwse-resize",name:"top-left"},{x:100,y:0,cursor:"nesw-resize",name:"top-right"},{x:100,y:100,cursor:"nwse-resize",name:"bottom-right"},{x:0,y:100,cursor:"nesw-resize",name:"bottom-left"}].forEach(l=>{const c=document.createElement("div");c.className="resize-handle",c.contentEditable="false",c.setAttribute("data-handle",l.name),c.setAttribute("role","slider"),c.setAttribute("aria-label",`Resize image ${l.name}`),c.tabIndex=0,c.style.left=`calc(${l.x}% - 6px)`,c.style.top=`calc(${l.y}% - 6px)`,c.setAttribute("aria-hidden",a?"false":"true"),c.style.cursor=l.cursor,c.addEventListener("mousedown",m=>{m.preventDefault(),m.stopPropagation();const v=m.clientX;m.clientY;const x=r.offsetWidth,N=r.offsetHeight,u=x/N||1;function p(C){let T=0;l.name.includes("left")?T=v-C.clientX:T=C.clientX-v;let b=Math.max(32,Math.round(x+T)),B=Math.max(32,Math.round(b/u));r.style.width=b+"px",r.style.height=B+"px"}function k(){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",k);const C=s.state.tr.setNodeMarkup(n(),void 0,{...e.attrs,width:r.style.width,height:r.style.height});s.view.dispatch(C)}document.addEventListener("mousemove",p),document.addEventListener("mouseup",k)}),c.addEventListener("keydown",m=>{const v=m.shiftKey?10:1,x=r.offsetWidth,N=r.offsetHeight;let u=x,p=N;if(m.key==="ArrowRight"&&(u=x+v),m.key==="ArrowLeft"&&(u=Math.max(32,x-v)),m.key==="ArrowDown"&&(p=N+v),m.key==="ArrowUp"&&(p=Math.max(32,N-v)),m.key==="Enter"){const k=s.state.tr.setNodeMarkup(n(),void 0,{...e.attrs,width:r.style.width,height:r.style.height});s.view.dispatch(k)}else r.style.width=u+"px",r.style.height=p+"px",m.preventDefault()}),o.appendChild(c)}),o.appendChild(r),d(!!a),{dom:o,contentDOM:null,update:(l,c,m)=>(d(!!m),!0)}}}}),qn=Qt.extend({addNodeView(){return({node:e,getPos:n,editor:s,selected:a})=>{const r=document.createElement("div");r.style.position="relative",r.style.display="block",r.style.width="100%",r.style.boxSizing="border-box";const o=document.createElement("div");o.style.display="block",r.appendChild(o);let i=[];function d(){i.forEach(m=>m.remove()),i=[]}function h(m,v,x,N){const u=document.createElement("div");return u.className="table-resize-handle",u.setAttribute("data-handle",N),u.style.left=`calc(${m}% - 6px)`,u.style.top=`calc(${v}% - 6px)`,u.style.cursor=x,u.tabIndex=0,u.setAttribute("role","slider"),u.setAttribute("aria-label",`Resize table ${N}`),u.setAttribute("aria-hidden",a?"false":"true"),u}function l(){const m=o.querySelector("table");if(!m){d();return}d(),[{x:0,y:0,cursor:"nwse-resize",name:"top-left"},{x:50,y:0,cursor:"ns-resize",name:"top-center"},{x:100,y:0,cursor:"nesw-resize",name:"top-right"},{x:100,y:50,cursor:"ew-resize",name:"middle-right"},{x:100,y:100,cursor:"nwse-resize",name:"bottom-right"},{x:50,y:100,cursor:"ns-resize",name:"bottom-center"},{x:0,y:100,cursor:"nesw-resize",name:"bottom-left"},{x:0,y:50,cursor:"ew-resize",name:"middle-left"}].forEach(x=>{const N=h(x.x,x.y,x.cursor,x.name);N.addEventListener("mousedown",u=>{u.preventDefault(),u.stopPropagation();const p=u.clientX,k=u.clientY,C=m.offsetWidth,T=m.offsetHeight;function b(w){let D=C,I=T;x.name.includes("left")&&(D=Math.max(64,C-(w.clientX-p))),x.name.includes("right")&&(D=Math.max(64,C+(w.clientX-p))),x.name.includes("top")&&(I=Math.max(32,T-(w.clientY-k))),x.name.includes("bottom")&&(I=Math.max(32,T+(w.clientY-k))),m.style.width=D+"px",m.style.height=I+"px"}function B(){document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",B);try{const w=n();if(typeof w=="number"){const D={...e.attrs};D.style=m.getAttribute("style")||"";const I=s.state.tr.setNodeMarkup(w,void 0,D);s.view.dispatch(I)}}catch{}}document.addEventListener("mousemove",b),document.addEventListener("mouseup",B)}),N.addEventListener("keydown",u=>{const p=u.shiftKey?10:1,k=m.offsetWidth,C=m.offsetHeight;let T=k,b=C;if(u.key==="ArrowRight"&&(T=k+p),u.key==="ArrowLeft"&&(T=Math.max(64,k-p)),u.key==="ArrowDown"&&(b=C+p),u.key==="ArrowUp"&&(b=Math.max(32,C-p)),m.style.width=T+"px",m.style.height=b+"px",u.key==="Enter")try{const B=n();if(typeof B=="number"){const w={...e.attrs};w.style=m.getAttribute("style")||"";const D=s.state.tr.setNodeMarkup(B,void 0,w);s.view.dispatch(D)}}catch{}u.preventDefault()}),r.appendChild(N),i.push(N)})}const c=new MutationObserver(l);return c.observe(o,{childList:!0,subtree:!0}),setTimeout(l,20),{dom:r,contentDOM:o,update:(m,v,x)=>(i.forEach(N=>N.setAttribute("aria-hidden",x?"false":"true")),l(),!0),destroy:()=>c.disconnect()}}}}),F=Xe.memo(function({onClick:n,active:s,title:a,children:r}){return t.jsx("button",{title:a,onClick:n,className:`p-2 rounded hover:bg-[#EBECF0] dark:hover:bg-[#101828] transition ${s?"bg-[#EBECF0] dark:bg-[#101828]":""}`,type:"button",children:r})});function Xn({editor:e}){if(!e)return null;const n=r=>()=>{r(e.chain().focus()).run()},s=()=>{const r=prompt("Enter URL");r&&e.chain().focus().setLink({href:r}).run()},a=()=>{const r=prompt("Image URL (must end with .jpg, .jpeg, .png, .gif, .webp, .svg) or base64:");if(!r)return;const o=r.startsWith("data:image/"),i=/\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i.test(r);if(!o&&!i){alert("Please enter a direct image URL ending with .jpg, .jpeg, .png, .gif, .webp, .svg or a base64 image.");return}e.chain().focus().setImage({src:r}).run()};return t.jsx("div",{className:"sticky top-14 z-30 bg-toolbarBg dark:bg-[#0B0F1A] border-b border-borderLight dark:border-[#1F2937] shadow-toolbar",children:t.jsxs("div",{className:"max-w-5xl mx-auto flex items-center gap-1 px-3 h-11",children:[t.jsx(F,{title:"Bold",onClick:n(r=>r.toggleBold()),active:e.isActive("bold"),children:t.jsx(At,{className:"w-4 h-4"})}),t.jsx(F,{title:"Italic",onClick:n(r=>r.toggleItalic()),active:e.isActive("italic"),children:t.jsx(Ct,{className:"w-4 h-4"})}),t.jsx(F,{title:"Underline",onClick:n(r=>{var o;return(o=r.toggleUnderline)==null?void 0:o.call(r)}),active:e.isActive("underline"),children:t.jsx(Ft,{className:"w-4 h-4"})}),t.jsx(F,{title:"Strike",onClick:n(r=>r.toggleStrike()),active:e.isActive("strike"),children:t.jsx(Tt,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Heading",onClick:n(r=>r.toggleHeading({level:2})),active:e.isActive("heading",{level:2}),children:t.jsx(Dt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Bulleted list",onClick:n(r=>r.toggleBulletList()),active:e.isActive("bulletList"),children:t.jsx(Bt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Numbered list",onClick:n(r=>r.toggleOrderedList()),active:e.isActive("orderedList"),children:t.jsx(It,{className:"w-4 h-4"})}),t.jsx(F,{title:"Checklist",onClick:n(r=>r.toggleTaskList()),active:e.isActive("taskList"),children:t.jsx(Mt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Quote",onClick:n(r=>r.toggleBlockquote()),active:e.isActive("blockquote"),children:t.jsx(Pt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Rule",onClick:n(r=>r.setHorizontalRule()),children:t.jsx(Ot,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Code block",onClick:n(r=>r.toggleCodeBlock()),active:e.isActive("codeBlock"),children:t.jsx(Ut,{className:"w-4 h-4"})}),t.jsx(F,{title:"Link",onClick:s,active:e.isActive("link"),children:t.jsx(Rt,{className:"w-4 h-4"})}),t.jsx(F,{title:"Image",onClick:a,children:t.jsx($t,{className:"w-4 h-4"})}),t.jsx(F,{title:"Insert table",onClick:n(r=>r.insertTable({rows:3,cols:4,withHeaderRow:!0})),children:t.jsx(Ht,{className:"w-4 h-4"})}),t.jsx(F,{title:"Add row",onClick:n(r=>r.addRowAfter()),children:t.jsx("span",{className:"text-xs",children:"+Row"})}),t.jsx(F,{title:"Del row",onClick:n(r=>r.deleteRow()),children:t.jsx("span",{className:"text-xs",children:"-Row"})}),t.jsx(F,{title:"Add col",onClick:n(r=>r.addColumnAfter()),children:t.jsx("span",{className:"text-xs",children:"+Col"})}),t.jsx(F,{title:"Del col",onClick:n(r=>r.deleteColumn()),children:t.jsx("span",{className:"text-xs",children:"-Col"})}),t.jsx(F,{title:"Del table",onClick:n(r=>r.deleteTable()),children:t.jsx("span",{className:"text-xs",children:"XTbl"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Search (Ctrl+K)",onClick:()=>window.dispatchEvent(new CustomEvent("open-search")),children:t.jsx(Ge,{className:"w-4 h-4"})}),t.jsx(F,{title:"Comments",onClick:()=>window.dispatchEvent(new CustomEvent("open-comments")),children:t.jsx(zt,{className:"w-4 h-4"})}),t.jsx(F,{title:"History",onClick:()=>window.dispatchEvent(new CustomEvent("open-history")),children:t.jsx(Wt,{className:"w-4 h-4"})}),t.jsx("span",{className:"mx-2 w-px h-6 bg-borderLight dark:bg-[#1F2937]"}),t.jsx(F,{title:"Undo",onClick:n(r=>r.undo()),children:t.jsx(_t,{className:"w-4 h-4"})}),t.jsx(F,{title:"Redo",onClick:n(r=>r.redo()),children:t.jsx(Jt,{className:"w-4 h-4"})})]})})}const Yn=new Map;function Qn(e){return`draftAutosave:${e}`}function Gn(e){try{const n=Yn.get(Qn(e));return!!(n&&String(n).trim().length>0)}catch{return!1}}function Vn({docId:e}){return Gn(e)?t.jsx("span",{className:"ml-2 inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 border border-amber-300 text-amber-700 rounded bg-amber-50 dark:bg-[#2B1B00] dark:border-amber-600 dark:text-amber-300",children:"Draft saved"}):null}const Zn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let es=(e=21)=>{let n="",s=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)n+=Zn[s[e]&63];return n};const ts=Gt.create({name:"blockId",addGlobalAttributes(){return[{types:["paragraph","heading","blockquote","codeBlock"],attributes:{"data-block-id":{default:null,rendered:!0,parseHTML:e=>e.getAttribute("data-block-id"),renderHTML:e=>({"data-block-id":e["data-block-id"]||es(8)})}}}]}});function ns(e,n){const s=M();s.history[e]=s.history[e]||[],s.history[e].unshift({...n,ts:Date.now()}),s.history[e]=s.history[e].slice(0,50),te(s),O(s)}function ss(e){return M().history[e]||[]}function rs({open:e,onClose:n,history:s=[],onRestore:a}){return e?t.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex",children:t.jsxs("div",{className:"ml-auto w-[420px] h-full bg-white dark:bg-[#0B0F1A] border-l border-borderLight dark:border-[#1F2937] p-4 overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold",children:"Version history"}),t.jsx("button",{onClick:n,className:"text-sm underline",children:"Close"})]}),s.length===0?t.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}):s.map((r,o)=>t.jsxs("div",{className:"border border-borderLight dark:border-[#1F2937] rounded p-3 mb-3",children:[t.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[new Date(r.ts).toLocaleString()," 5 ",r.user||"Unknown"]}),t.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:r.content}}),t.jsx("div",{className:"mt-2",children:t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:()=>a(r),children:"Restore"})})]},o))]})}):null}function it(e,n=[]){for(const s of e)s.type==="doc"&&n.push(s),s.children&&it(s.children,n);return n}function as(e){const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""}function os({open:e,onClose:n}){const[s,a]=f.useState(""),r=Fe(),o=_(),i=it(o),d=f.useMemo(()=>{if(!s.trim())return[];const l=s.toLowerCase();return i.map(c=>{var u;const v=loadAppdata().docs[c.id]||{},x=re(v.content||((u=c.initial)==null?void 0:u.content)||"");return`${c.title} ${as(x)}`.toLowerCase().includes(l)?{id:c.id,title:v.title||c.title}:null}).filter(Boolean).slice(0,30)},[s]),h=l=>{n(),r(`/docs/${l}`)};return f.useEffect(()=>{const l=c=>{c.key==="Escape"&&n()};return e&&window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e]),e?t.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-start justify-center pt-24",children:t.jsxs("div",{className:"w-[640px] bg-white dark:bg-[#0B0F1A] rounded border border-borderLight dark:border-[#1F2937] p-4",children:[t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-3 bg-white dark:bg-[#0F172A]",placeholder:"Search pages and content…",value:s,onChange:l=>a(l.target.value),autoFocus:!0}),t.jsxs("div",{className:"max-h-[50vh] overflow-y-auto",children:[d.map(l=>t.jsx("div",{onClick:()=>h(l.id),className:"px-2 py-2 rounded cursor-pointer hover:bg-[#F4F5F7] dark:hover:bg-[#101828]",children:l.title},l.id)),s&&d.length===0&&t.jsx("div",{className:"text-sm text-gray-500 px-2 py-2",children:"No results"})]})]})}):null}function ct({open:e,onClose:n}){const[s,a]=f.useState(X()),[r,o]=f.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||""}),[i,d]=f.useState("");if(f.useEffect(()=>{if(e){const l=X();a(l),o({name:(l==null?void 0:l.name)||"",email:(l==null?void 0:l.email)||""})}},[e]),!e)return null;const h=()=>{const l=r.name.trim()||"Unnamed",c=r.email.trim();Nn(s.username,{name:l,email:c}),nt({...s,name:l,email:c}),d("Profile updated!"),setTimeout(()=>d(""),2e3)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black bg-opacity-20",children:t.jsxs("div",{className:"relative mt-12 w-full max-w-lg bg-white dark:bg-[#101828] rounded-xl shadow-2xl p-8 border border-borderLight dark:border-[#1F2937] animate-fade-in",children:[t.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-700 dark:hover:text-white p-1 rounded-full focus:outline-none",children:t.jsx(Kt,{className:"w-6 h-6"})}),t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"User Settings"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),t.jsx("input",{className:"w-full text-base px-3 py-2 rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A]",value:r.name,onChange:l=>o(c=>({...c,name:l.target.value})),placeholder:"Name"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),t.jsx("input",{className:"w-full text-base px-3 py-2 rounded border border-borderLight dark:border-[#1F2937] bg-white dark:bg-[#0F172A]",value:r.email,onChange:l=>o(c=>({...c,email:l.target.value})),placeholder:"Email"})]}),t.jsx("button",{onClick:h,className:"px-5 py-2 rounded bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition",children:"Save"}),i&&t.jsx("div",{className:"mt-3 text-green-600 dark:text-green-400",children:i})]})})}function is({open:e,onClose:n,anchorRef:s}){var l;const[a,r]=f.useState(X()),[o,i]=f.useState(!1),d=f.useRef(null);if(f.useEffect(()=>{const c=()=>r(X());return window.addEventListener("current-user-updated",c),()=>window.removeEventListener("current-user-updated",c)},[]),f.useEffect(()=>{if(!e)return;function c(m){d.current&&!d.current.contains(m.target)&&(!s||!s.current||!s.current.contains(m.target))&&n()}return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[e,n,s]),o)return t.jsx(ct,{open:o,onClose:()=>i(!1)});if(!e||!a)return null;let h={position:"absolute",top:60,right:24,zIndex:1e3};if(s&&s.current){const c=s.current.getBoundingClientRect();h={position:"absolute",top:c.bottom+8+window.scrollY,left:c.left+window.scrollX-180+c.width/2,zIndex:1e3}}return t.jsxs("div",{ref:d,style:h,className:"bg-white dark:bg-[#101828] rounded-xl shadow-2xl border border-borderLight dark:border-[#1F2937] w-80 p-5 flex flex-col gap-2 animate-fade-in",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-atlassianBlue to-blue-400 flex items-center justify-center text-white text-xl font-bold uppercase shadow-sm",children:((l=a.username)==null?void 0:l.slice(0,2))||"U"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-lg",children:a.name||a.username}),t.jsx("div",{className:"text-xs text-textSecondary dark:text-gray-400",children:a.email||"—"}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Role: ",t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:a.role||"user"})]})]})]}),t.jsx("button",{onClick:()=>{i(!0),n()},className:"px-4 py-2 rounded bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition mt-2",children:"Settings"}),t.jsx("button",{onClick:()=>{Sn(),n()},className:"px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 font-semibold shadow hover:bg-gray-300 dark:hover:bg-gray-600 transition mt-1",children:"Sign Out"})]})}var cs="Expected a function",_e=NaN,ls="[object Symbol]",ds=/^\s+|\s+$/g,us=/^[-+]0x[0-9a-f]+$/i,fs=/^0b[01]+$/i,hs=/^0o[0-7]+$/i,ms=parseInt,ps=typeof de=="object"&&de&&de.Object===Object&&de,gs=typeof self=="object"&&self&&self.Object===Object&&self,xs=ps||gs||Function("return this")(),bs=Object.prototype,ys=bs.toString,ws=Math.max,vs=Math.min,Ne=function(){return xs.Date.now()};function js(e,n,s){var a,r,o,i,d,h,l=0,c=!1,m=!1,v=!0;if(typeof e!="function")throw new TypeError(cs);n=Je(n)||0,Ae(s)&&(c=!!s.leading,m="maxWait"in s,o=m?ws(Je(s.maxWait)||0,n):o,v="trailing"in s?!!s.trailing:v);function x(w){var D=a,I=r;return a=r=void 0,l=w,i=e.apply(I,D),i}function N(w){return l=w,d=setTimeout(k,n),c?x(w):i}function u(w){var D=w-h,I=w-l,R=n-D;return m?vs(R,o-I):R}function p(w){var D=w-h,I=w-l;return h===void 0||D>=n||D<0||m&&I>=o}function k(){var w=Ne();if(p(w))return C(w);d=setTimeout(k,u(w))}function C(w){return d=void 0,v&&a?x(w):(a=r=void 0,i)}function T(){d!==void 0&&clearTimeout(d),l=0,a=h=r=d=void 0}function b(){return d===void 0?i:C(Ne())}function B(){var w=Ne(),D=p(w);if(a=arguments,r=this,h=w,D){if(d===void 0)return N(h);if(m)return d=setTimeout(k,n),x(h)}return d===void 0&&(d=setTimeout(k,n)),i}return B.cancel=T,B.flush=b,B}function Ae(e){var n=typeof e;return!!e&&(n=="object"||n=="function")}function ks(e){return!!e&&typeof e=="object"}function Ns(e){return typeof e=="symbol"||ks(e)&&ys.call(e)==ls}function Je(e){if(typeof e=="number")return e;if(Ns(e))return _e;if(Ae(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Ae(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=e.replace(ds,"");var s=fs.test(e);return s||hs.test(e)?ms(e.slice(2),s?2:8):us.test(e)?_e:+e}var Ss=js;const Ke=mt(Ss);function Es(){const{id:e}=Ye(),n=()=>{const S=_(),E=typeof e=="string"?Ce(S,e):null;return(E==null?void 0:E.title)||"Untitled Page"},[s,a]=f.useState(n()),[r,o]=f.useState(!1),[i,d]=f.useState([]),[h,l]=f.useState(!1),[c,m]=f.useState(!1),[v,x]=f.useState(!1),[N,u]=f.useState(!1),p=f.useRef(null),[k]=f.useState("acquired"),[C,T]=f.useState(null),[b,B]=f.useState(!1),w=X()||{};f.useEffect(()=>{const S=()=>l(!0),E=()=>m(!0),j=()=>u(!0);return window.addEventListener("open-history",S),window.addEventListener("open-search",E),window.addEventListener("open-user-profile",j),()=>{window.removeEventListener("open-history",S),window.removeEventListener("open-search",E),window.removeEventListener("open-user-profile",j)}},[]);const[D,I]=f.useState(!1);f.useEffect(()=>{let S=!1;B(!1),I(!1);async function E(){try{const j=await W(`docs/${e}.json`);let P=null;if(j&&j.json)P=j.json;else if(j&&j.content)try{P=JSON.parse(j.content)}catch{P=null}if(!P)throw new Error("No content");if(a(P.title||n()),T(re(P.content)),I(!1),B(!0),!S){const y=M();y.docs[e]=P,te(y),O(y)}}catch{const P=M().docs[e];if(P){a(P.title||n()),T(re(P.content)),I(!1),B(!0);return}const y=_(),g=Ce(y,e);if(!g){I(!0),a("Page not found"),T(""),B(!0);return}const A=(g==null?void 0:g.initial)||{content:"<p>Start writing…</p>"};a((g==null?void 0:g.title)||n()),T(re(A.content)),I(!1),B(!0)}}return E(),()=>{S=!0}},[e]),f.useEffect(()=>{const S=()=>{const E=_(),j=rt(E,e);d(j||[])};return S(),window.addEventListener("docs-index-updated",S),()=>window.removeEventListener("docs-index-updated",S)},[e]);const R=Vt({extensions:[Zt.configure({history:!0}),en,ts,tn.configure({openOnClick:!0,autolink:!0}),Kn,nn,sn,rn,qn,an,on,cn],content:C||"",editable:k!=="failed",onUpdate:({editor:S})=>{const E=S.getHTML(),j=M(),P=!j.docs[e];let y=(w==null?void 0:w.username)||(w==null?void 0:w.email)||(w==null?void 0:w.name)||"Unknown";P&&(j.docs[e]={title:s,content:E,updatedAt:null,lastEditedBy:y}),j.docs[e].title=s,j.docs[e].content=E,j.docs[e].updatedAt=new Date().toISOString(),j.docs[e].lastEditedBy=y,te(j),O(j),On(e),o(!0),oe()}},[e,C,s,w.name]),oe=Ke(()=>o(!1),400);f.useEffect(()=>{const S=Ke(E=>{const j=M();j.docs[e]&&(j.docs[e].title=E),te(j),O(j);try{console.log("[EditorPage] updated doc title only",{id:e,title:E})}catch{}},500);return S(s),()=>S.cancel()},[s,e]),f.useEffect(()=>{const S=setInterval(()=>{const j=M().docs[e];j&&ns(e,{user:j.lastEditedBy,content:j.content,title:j.title})},6e4);return()=>clearInterval(S)},[e]);const ie=ss(e),[ne,Q]=f.useState({show:!1,type:"",message:""}),ye=async()=>{o(!0);const E=M().docs[e];if(!E){o(!1);return}const j=await W(`docs/${e}.json`),P=j==null?void 0:j.sha,y=await q(`docs/${e}.json`,E,P);o(!1),y.ok?(Q({show:!0,type:"success",message:"Saved the data"}),setTimeout(()=>Q({show:!1,type:"",message:""}),2e3)):(Q({show:!0,type:"error",message:"Save failed!"}),setTimeout(()=>Q({show:!1,type:"",message:""}),2e3))},J=S=>{R==null||R.commands.setContent(S.content,!1),a(S.title||s);const E=M();E.docs[e]&&(E.docs[e].content=S.content,S.title&&(E.docs[e].title=S.title),te(E),O(E)),l(!1)};return b?D?t.jsx("div",{className:"max-w-2xl mx-auto px-6 py-12 text-center text-lg text-red-600",children:t.jsx("strong",{children:"No document found."})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"sticky top-0 z-30 bg-white dark:bg-[#101828] shadow-sm border-b border-borderLight dark:border-[#232b3b]",children:t.jsx(Xn,{editor:R})}),t.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-white dark:bg-[#101828] rounded-2xl shadow-xl border border-borderLight dark:border-[#232b3b] p-8",children:[t.jsxs("nav",{className:"text-[15px] mb-4 text-gray-400 dark:text-gray-400 flex items-center flex-wrap gap-1",children:[t.jsx("span",{className:"text-atlassianBlue font-semibold cursor-pointer",children:"DocX"}),t.jsx("span",{className:"px-1",children:"/"}),i.length===0?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-atlassianBlue font-semibold cursor-pointer",children:"Pages"}),t.jsx("span",{className:"px-1",children:"/"}),t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-100",children:s||"Page"})]}):i.filter(S=>S.id!=="root").map((S,E,j)=>t.jsxs("span",{className:E===j.length-1?"font-semibold text-gray-700 dark:text-gray-100":"text-atlassianBlue font-semibold cursor-pointer hover:underline",children:[S.title||"Untitled",E<j.length-1&&t.jsx("span",{className:"px-1",children:"/"})]},S.id)),t.jsx("span",{className:"ml-3 inline-block text-[11px] px-2 py-0.5 border border-borderLight rounded-full bg-gray-100 dark:bg-[#232b3b] text-gray-500 dark:text-gray-300",children:"DRAFT"})]}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("input",{className:"flex-1 text-[2rem] font-bold placeholder:text-[#A5ADBA] bg-transparent outline-none dark:text-white rounded-lg px-2 py-1 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 transition",value:s,onChange:S=>a(S.target.value),placeholder:"Page title",style:{marginBottom:0}}),t.jsx("button",{onClick:ye,className:"ml-2 px-5 py-2 text-base rounded-lg bg-atlassianBlue text-white font-semibold shadow hover:brightness-110 transition",style:{whiteSpace:"nowrap"},children:"Save"})]}),t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-400",children:["Last edited by ",t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:wn()||(w==null?void 0:w.name)||(w==null?void 0:w.username)||(w==null?void 0:w.email)||"Unknown"}),t.jsx(Vn,{docId:e})]})}),t.jsxs("div",{className:"editor-surface p-4 rounded-xl bg-gray-50 dark:bg-[#181f2a] border border-gray-200 dark:border-[#232b3b]",children:[!R&&t.jsx(qe,{}),R&&t.jsx(ln,{editor:R,className:"prose max-w-none dark:prose-invert"})]})]})}),t.jsx(rs,{open:h,onClose:()=>l(!1),history:ie,onRestore:J}),t.jsx(os,{open:c,onClose:()=>m(!1)}),t.jsx(is,{open:N,onClose:()=>u(!1),anchorRef:p}),ne.show&&t.jsx("div",{className:`fixed top-6 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded shadow-lg z-50 transition-all ${ne.type==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:ne.message})]}):t.jsx(qe,{})}function Ce(e,n){for(const s of e){if(s.type==="doc"&&s.id===n)return s;if(s.children){const a=Ce(s.children,n);if(a)return a}}return null}function qe(){return t.jsxs("div",{className:"space-y-4 animate-pulse","aria-label":"Loading editor",children:[t.jsx("div",{className:"h-5 w-2/5 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 w-full rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-11/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-5/6 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-2/3 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-3/4 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-1/2 rounded bg-gray-200 dark:bg-[#1F2937]"})]}),t.jsx("div",{className:"h-5 w-1/3 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 w-full rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-10/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-9/12 rounded bg-gray-200 dark:bg-[#1F2937]"}),t.jsx("div",{className:"h-4 w-2/3 rounded bg-gray-200 dark:bg-[#1F2937]"})]})]})}function Ls(){const{id:e}=Ye(),[n,s]=f.useState(!1),[a,r]=f.useState({title:"Untitled",content:"<p>No content.</p>"});f.useEffect(()=>{let i=!0;const d=M();if(d.docs[e]){r(d.docs[e]);return}return s(!0),Wn().then(()=>{if(!i)return;const h=M().docs[e];h&&r(h),s(!1)}),()=>{i=!1}},[e]);const o=re(a.content);return t.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[t.jsxs("h1",{className:"text-3xl font-semibold mb-6",children:[a.title,n&&t.jsx("span",{className:"ml-2 text-xs text-textSecondary",children:"(loading…)"})]}),n?t.jsxs("div",{className:"animate-pulse space-y-3 bg-white dark:bg-[#0F172A] p-6 rounded border border-borderLight dark:border-[#1F2937]",children:[t.jsx("div",{className:"h-4 w-3/4 bg-gray-200 dark:bg-[#1F2937] rounded"}),t.jsx("div",{className:"h-4 w-2/3 bg-gray-200 dark:bg-[#1F2937] rounded"}),t.jsx("div",{className:"h-4 w-1/2 bg-gray-200 dark:bg-[#1F2937] rounded"})]}):t.jsx("article",{className:"prose max-w-none bg-white dark:bg-[#0F172A] p-6 rounded border border-borderLight dark:border-[#1F2937]",dangerouslySetInnerHTML:{__html:o}})]})}function me(){return!!X()}function As(){const e=me(),[n,s]=f.useState(!1);function a(o){for(const i of o){if(i.type==="doc")return i.id;if(i.children){const d=a(i.children);if(d)return d}}return null}let r="demo";if(e){const o=_();r=a(o)||"demo"}return t.jsxs("div",{className:"min-h-screen text-textPrimary dark:text-white",children:[t.jsx(Bn,{}),t.jsxs("div",{className:"flex flex-nowrap",children:[e&&t.jsx("div",{style:{width:n?48:256,minWidth:n?48:180,maxWidth:n?48:480},className:"h-[calc(100vh-56px)] bg-white dark:bg-[#101624] border-r border-gray-200 dark:border-gray-800 transition-all duration-150 ease-in-out",children:t.jsx(Jn,{collapsed:n,setCollapsed:s})}),t.jsx("div",{className:"flex-1 min-h-[calc(100vh-56px)] bg-[#FAFBFC] dark:bg-[#0B0F1A] transition-all duration-150 ease-in-out",children:t.jsxs(Qe,{children:[t.jsx(Z,{path:"/",element:e?t.jsx(se,{to:`/view/${r}`,replace:!0}):t.jsx(se,{to:"/login",replace:!0})}),t.jsx(Z,{path:"/docs/:id",element:me()?t.jsx(Es,{}):t.jsx(se,{to:"/login"})}),t.jsx(Z,{path:"/view/:id",element:me()?t.jsx(Ls,{}):t.jsx(se,{to:"/login"})}),t.jsx(Z,{path:"/settings",element:me()?t.jsx(ct,{}):t.jsx(se,{to:"/login"})})]})})]})]})}function Cs(){const[e,n]=f.useState(""),[s,a]=f.useState(""),r=Fe(),o=async()=>{var N;const i=await jn()||[];console.debug("[Login] fetched users list",i);const d=String(e||"").trim(),h=String(s||"").trim(),l=Array.isArray(i)?i:i?Object.values(i):[],c=l.find(u=>{if(!u)return!1;const p=String(u.username||u.id||u.email||"").trim(),k=String(u.password||"").trim();return p===d&&k===h});if(!c)return console.debug("[Login] credentials did not match any remote user",{uname:d,usersArray:l}),alert("Invalid credentials");nt(c);try{K()||console.debug("[Login] remote token not present; attempting anonymous fetch");let u=await W("index.json");if(console.debug("[Login] fetched remote index.json",u),!u||!u.json){console.log("[Login] appdata.json not found, trying index.json");const p=await W("index.json");if(console.debug("[Login] fetched remote index.json",p),p!=null&&p.json){const k={index:p.json,docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:new Date().toISOString(),dirty:!1}};try{O(k)}catch(C){console.warn("[Login] saveAppdata(minimal) failed",C)}}else console.warn("[Login] neither appdata.json nor index.json found in remote repo")}else try{let p=null;if(u.json&&Array.isArray(u.json.index)?p=u.json.index:Array.isArray(u.json)?p=u.json:u.json&&Array.isArray((N=u.json.index)!=null&&N.children?u.json.index:null)&&(p=u.json.index),p===null)console.warn("[Login] remote returned unexpected shape; skipping saveAppdata");else{const k={index:p,docs:{},comments:{},history:{},users:{},syncMeta:{lastSync:new Date().toISOString(),dirty:!1}};try{O(k),console.log("[Login] loaded minimal Appdata (index only) into memory")}catch(C){console.warn("[Login] saveAppdata(minimal) failed",C)}}}catch(p){console.warn("[Login] saveAppdata failed",p)}}catch(u){console.warn("[Login] fetch remote appdata failed",u)}let m=_();Array.isArray(m)||(console.warn("[Login] docs index is missing or malformed, falling back to default root"),m=[{id:"root",type:"folder",title:"Pages",children:[]}]);const v=u=>{for(const p of u){if(p.type==="doc")return p.id;if(p.children){const k=v(p.children);if(k)return k}}return null};let x=v(m);if(x)try{const u=await W(`docs/${x}.json`);if(u!=null&&u.json){const p=M();p.docs=p.docs||{};const k=u.json;p.docs[x]={title:k.title||p.docs[x]&&p.docs[x].title||"Untitled Page",content:k.content||p.docs[x]&&p.docs[x].content||"<p>Start writing\x0026hellip;</p>",updatedAt:k.updatedAt||p.docs[x]&&p.docs[x].updatedAt||null,lastEditedBy:k.lastEditedBy||p.docs[x]&&p.docs[x].lastEditedBy||"Unknown"},O(p)}}catch(u){console.warn("[Login] fetch remote doc failed",u)}else{const u=M();x=An(u,"root","Page title","<p>Start writing…</p>")}r(`/docs/${x}`)};return t.jsx("div",{className:"h-screen flex items-center justify-center bg-[#F4F5F7] dark:bg-[#0B0F1A]",children:t.jsxs("div",{className:"bg-white dark:bg-[#0F172A] rounded shadow-lg p-6 w-80 border border-borderLight dark:border-[#1F2937]",children:[t.jsx("h2",{className:"text-center text-lg font-semibold mb-4",children:"Login"}),t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-3 bg-white dark:bg-[#0B0F1A]",placeholder:"username",value:e,onChange:i=>n(i.target.value)}),t.jsx("input",{className:"w-full border border-borderLight dark:border-[#1F2937] rounded px-3 py-2 mb-4 bg-white dark:bg-[#0B0F1A]",placeholder:"password",type:"password",value:s,onChange:i=>a(i.target.value)}),t.jsx("button",{onClick:o,className:"w-full bg-atlassianBlue text-white py-2 rounded hover:brightness-110",children:"Login"})]})})}function Fs(){const[e,n]=f.useState(!1);return f.useEffect(()=>{const s=a=>n(!!a.detail);return window.addEventListener("blocking-loader",s),()=>window.removeEventListener("blocking-loader",s)},[]),e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:t.jsxs("div",{className:"bg-white dark:bg-[#0B1220] p-6 rounded shadow flex items-center gap-3",children:[t.jsx(Ve,{className:"w-6 h-6 animate-spin text-blue-600"}),t.jsx("span",{className:"text-sm",children:"Syncing"})]})}):null}window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("open-search")))});const Ts=()=>t.jsxs(pt,{basename:"/DocX-Build/",children:[t.jsx(Fs,{}),t.jsxs(Qe,{children:[t.jsx(Z,{path:"/login",element:t.jsx(Cs,{})}),t.jsx(Z,{path:"/*",element:t.jsx(As,{})})]})]});Se.createRoot(document.getElementById("root")).render(t.jsx(Xe.StrictMode,{children:t.jsx(Ts,{})}));
